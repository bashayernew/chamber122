<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debug Login Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #0b0c12; color: #e9e9f1; }
    .card { background: #101321; border: 1px solid #222640; border-radius: 16px; padding: 20px; margin: 20px 0; }
    input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #262b45; background: #0c1022; color: #f2f3ff; }
    button { background: #6f75ff; border: 0; font-weight: 700; cursor: pointer; }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    pre { background: #1a1a1a; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Debug Login Test</h1>
  
  <div class="card">
    <h3>Test Login</h3>
    <input type="email" id="email" placeholder="your@email.com" value="test@example.com">
    <input type="password" id="password" placeholder="password" value="testpass123">
    <button onclick="testLogin()">Test Login</button>
    <div id="result"></div>
  </div>

  <div class="card">
    <h3>Supabase Status</h3>
    <button onclick="checkSupabase()">Check Supabase Connection</button>
    <div id="supabase-status"></div>
  </div>

  <div class="card">
    <h3>Console Logs</h3>
    <pre id="logs"></pre>
  </div>

  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.57.4';
    import { supabase } from './js/supabase-client.js';

    function log(message, type = 'info') {
      const logs = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#e9e9f1';
      logs.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
      console.log(`[${timestamp}] ${message}`);
    }

    window.testLogin = async function() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const result = document.getElementById('result');
      
      log(`Attempting login with email: ${email}`);
      
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        
        if (error) {
          log(`Login error: ${error.message}`, 'error');
          result.innerHTML = `<div class="error">Error: ${error.message}</div>`;
        } else {
          log(`Login successful!`, 'success');
          log(`User: ${JSON.stringify(data.user, null, 2)}`, 'success');
          result.innerHTML = `<div class="success">Login successful! User ID: ${data.user.id}</div>`;
        }
      } catch (err) {
        log(`Exception during login: ${err.message}`, 'error');
        result.innerHTML = `<div class="error">Exception: ${err.message}</div>`;
      }
    };

    window.checkSupabase = async function() {
      const status = document.getElementById('supabase-status');
      
      try {
        log('Checking Supabase connection...');
        
        // Test basic connection
        const { data, error } = await supabase.from('profiles').select('count').limit(1);
        
        if (error) {
          log(`Supabase connection error: ${error.message}`, 'error');
          status.innerHTML = `<div class="error">Connection Error: ${error.message}</div>`;
        } else {
          log('Supabase connection successful!', 'success');
          status.innerHTML = `<div class="success">Supabase connected successfully</div>`;
        }
        
        // Test auth
        const { data: session } = await supabase.auth.getSession();
        log(`Current session: ${session?.session ? 'Active' : 'None'}`, session?.session ? 'success' : 'info');
        
      } catch (err) {
        log(`Supabase check exception: ${err.message}`, 'error');
        status.innerHTML = `<div class="error">Exception: ${err.message}</div>`;
      }
    };

    // Initial checks
    log('Debug page loaded');
    checkSupabase();
  </script>
</body>
</html>