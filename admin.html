<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Chamber122</title>
  <meta name="description" content="Admin dashboard for managing users, MSMEs, events, and bulletins">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/css/header.css?v=1">
  <link rel="stylesheet" href="/css/style.css?v=17">
  <link rel="stylesheet" href="/css/admin.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body style="background: #0f0f0f; margin: 0; padding: 0;">
  <!-- Admin Login Form (shown when not logged in) -->
  <div id="admin-login-container" style="display: none; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 40px;">
    <div style="background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; padding: 40px; max-width: 400px; width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
      <div style="text-align: center; margin-bottom: 32px;">
        <h1 style="color: #fff; font-size: 28px; font-weight: 700; margin: 0 0 8px 0;">Admin Login</h1>
        <p style="color: #a8a8a8; font-size: 14px; margin: 0;">Enter your credentials to access the admin dashboard</p>
      </div>
      <form id="admin-login-form" style="display: flex; flex-direction: column; gap: 20px;">
        <div>
          <label style="display: block; color: #fff; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Email</label>
          <input type="email" id="admin-email" placeholder="admin@123123.com" required style="width: 100%; padding: 12px; background: #0f0f0f; border: 1px solid #2a2a2a; border-radius: 8px; color: #fff; font-size: 14px; box-sizing: border-box;">
        </div>
        <div>
          <label style="display: block; color: #fff; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Password</label>
          <input type="password" id="admin-password" placeholder="Enter password" required style="width: 100%; padding: 12px; background: #0f0f0f; border: 1px solid #2a2a2a; border-radius: 8px; color: #fff; font-size: 14px; box-sizing: border-box;">
        </div>
        <div id="admin-login-error" style="color: #ef4444; font-size: 14px; display: none; text-align: center;"></div>
        <button type="submit" id="admin-login-btn" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #0095f6, #1877f2); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: opacity 0.2s;">
          Login
        </button>
      </form>
    </div>
  </div>

  <!-- Admin Dashboard (shown when logged in) -->
  <main id="admin-dashboard-container" class="admin-dashboard-container" style="display: none; padding-top: 0;">
    <div class="admin-layout">
      <!-- Sidebar -->
      <aside class="admin-sidebar">
        <div class="admin-sidebar-header">
          <h2><i class="fas fa-shield-alt"></i> Admin Panel</h2>
        </div>
        <nav class="admin-sidebar-nav">
          <a href="#users" class="admin-nav-item active" data-section="users">
            <i class="fas fa-users"></i> Users
          </a>
          <a href="#msmes" class="admin-nav-item" data-section="msmes">
            <i class="fas fa-building"></i> MSMEs
          </a>
          <a href="#events" class="admin-nav-item" data-section="events">
            <i class="fas fa-calendar-alt"></i> Events
          </a>
          <a href="#bulletins" class="admin-nav-item" data-section="bulletins">
            <i class="fas fa-bullhorn"></i> Bulletins
          </a>
          <a href="#messages" class="admin-nav-item" data-section="messages">
            <i class="fas fa-envelope"></i> Messages
          </a>
          <a href="#communities" class="admin-nav-item" data-section="communities">
            <i class="fas fa-users"></i> Communities
          </a>
          <a href="#documents" class="admin-nav-item" data-section="documents">
            <i class="fas fa-file-alt"></i> Documents
          </a>
          <a href="#settings" class="admin-nav-item" data-section="settings">
            <i class="fas fa-cog"></i> Settings
          </a>
        </nav>
        <div class="admin-sidebar-footer">
          <button onclick="adminDashboard.logout()" class="btn-logout">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="admin-content">
        <!-- Users Section -->
        <section id="section-users" class="admin-section active">
          <div class="admin-section-header">
            <h1><i class="fas fa-users"></i> Users Management</h1>
            <div class="admin-stats">
              <div class="stat-card">
                <div class="stat-value" id="stat-total-users">0</div>
                <div class="stat-label">Total Users</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-pending-users">0</div>
                <div class="stat-label">Pending</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-approved-users">0</div>
                <div class="stat-label">Approved</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-suspended-users">0</div>
                <div class="stat-label">Suspended</div>
              </div>
            </div>
          </div>
          <div class="admin-filters">
            <input type="text" id="users-search" placeholder="Search users by email..." class="admin-search">
            <select id="users-filter" class="admin-filter">
              <option value="all">All Users</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="suspended">Suspended</option>
              <option value="admin">Admins</option>
            </select>
          </div>
           <div id="users-container" style="display: grid; grid-template-columns: 1fr; gap: 20px; padding: 20px 0;">
             <div style="text-align: center; padding: 40px; color: #6b7280;">
               <i class="fas fa-spinner fa-spin"></i> Loading users...
             </div>
           </div>
        </section>

        <!-- MSMEs Section -->
        <section id="section-msmes" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-building"></i> MSMEs Management</h1>
            <div class="admin-stats">
              <div class="stat-card">
                <div class="stat-value" id="stat-total-msmes">0</div>
                <div class="stat-label">Total MSMEs</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-pending-msmes">0</div>
                <div class="stat-label">Pending</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-approved-msmes">0</div>
                <div class="stat-label">Approved</div>
              </div>
            </div>
          </div>
          <div class="admin-filters">
            <input type="text" id="msmes-search" placeholder="Search MSMEs by name..." class="admin-search">
            <select id="msmes-filter" class="admin-filter">
              <option value="all">All MSMEs</option>
              <option value="pending">Pending</option>
              <option value="approved">Approved</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Business Name</th>
                  <th>Owner</th>
                  <th>Industry</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="msmes-table-body">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin"></i> Loading MSMEs...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Events Section -->
        <section id="section-events" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-calendar-alt"></i> Events Management</h1>
            <div class="admin-stats">
              <div class="stat-card">
                <div class="stat-value" id="stat-total-events">0</div>
                <div class="stat-label">Total Events</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-pending-events">0</div>
                <div class="stat-label">Pending</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-published-events">0</div>
                <div class="stat-label">Published</div>
              </div>
            </div>
          </div>
          <div class="admin-filters">
            <input type="text" id="events-search" placeholder="Search events..." class="admin-search">
            <select id="events-filter" class="admin-filter">
              <option value="all">All Events</option>
              <option value="pending">Pending</option>
              <option value="published">Published</option>
              <option value="draft">Draft</option>
            </select>
          </div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Business</th>
                  <th>Start Date</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="events-table-body">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin"></i> Loading events...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Bulletins Section -->
        <section id="section-bulletins" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-bullhorn"></i> Bulletins Management</h1>
            <div class="admin-stats">
              <div class="stat-card">
                <div class="stat-value" id="stat-total-bulletins">0</div>
                <div class="stat-label">Total Bulletins</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-pending-bulletins">0</div>
                <div class="stat-label">Pending</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-published-bulletins">0</div>
                <div class="stat-label">Published</div>
              </div>
            </div>
          </div>
          <div class="admin-filters">
            <input type="text" id="bulletins-search" placeholder="Search bulletins..." class="admin-search">
            <select id="bulletins-filter" class="admin-filter">
              <option value="all">All Bulletins</option>
              <option value="pending">Pending</option>
              <option value="published">Published</option>
              <option value="draft">Draft</option>
            </select>
          </div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Business</th>
                  <th>Deadline</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="bulletins-table-body">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin"></i> Loading bulletins...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Messages Section -->
        <section id="section-messages" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-envelope"></i> Messages Management</h1>
          </div>
          <div class="admin-filters">
            <input type="text" id="messages-search" placeholder="Search messages..." class="admin-search">
            <select id="messages-filter" class="admin-filter">
              <option value="all">All Messages</option>
              <option value="admin-to-user">Admin → User</option>
              <option value="user-to-admin">User → Admin</option>
              <option value="user-to-user">User → User</option>
            </select>
          </div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>From</th>
                  <th>To</th>
                  <th>Subject</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="messages-table-body">
                <tr>
                  <td colspan="5" style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin"></i> Loading messages...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Communities Section -->
        <section id="section-communities" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-users"></i> Communities Management</h1>
            <div class="admin-stats">
              <div class="stat-card">
                <div class="stat-value" id="stat-total-communities">0</div>
                <div class="stat-label">Total Communities</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-active-communities">0</div>
                <div class="stat-label">Active</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="stat-suspended-communities">0</div>
                <div class="stat-label">Suspended</div>
              </div>
            </div>
          </div>
          <div class="admin-filters">
            <input type="text" id="communities-search" placeholder="Search communities..." class="admin-search">
            <select id="communities-filter" class="admin-filter">
              <option value="all">All Communities</option>
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
            </select>
          </div>
          <div id="communities-container" style="display: grid; grid-template-columns: 1fr; gap: 20px; padding: 20px 0;">
            <div style="text-align: center; padding: 40px; color: #6b7280;">
              <i class="fas fa-spinner fa-spin"></i> Loading communities...
            </div>
          </div>
        </section>

        <!-- Documents Section -->
        <section id="section-documents" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-file-alt"></i> Documents Management</h1>
            <p style="color: #6b7280; margin-top: 8px;">View and manage documents submitted during signup and profile editing</p>
          </div>
          <div id="documents-filter-message" style="display: none; padding: 12px 16px; background: #2a2a2a; border-radius: 8px; margin-bottom: 16px; color: #f2c64b;">
            <i class="fas fa-filter"></i> <span></span>
            <button onclick="window.adminDocumentFilter = null; adminDashboard.loadDocuments();" style="margin-left: 12px; background: #1a1a1a; border: 1px solid #3a3a3a; color: #fff; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
              Clear Filter
            </button>
          </div>
          <div class="admin-filters">
            <input type="text" id="documents-search" placeholder="Search documents by user email..." class="admin-search">
            <select id="documents-filter" class="admin-filter">
              <option value="all">All Documents</option>
              <option value="pending">Pending Review</option>
              <option value="approved">Approved</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Business</th>
                  <th>Document Type</th>
                  <th>Uploaded</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="documents-table-body">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin"></i> Loading documents...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Settings Section -->
        <section id="section-settings" class="admin-section">
          <div class="admin-section-header">
            <h1><i class="fas fa-cog"></i> Settings</h1>
          </div>
          <div class="admin-settings">
            <div class="settings-card">
              <h3>System Information</h3>
              <div class="settings-item">
                <label>Total Users:</label>
                <span id="settings-total-users">0</span>
              </div>
              <div class="settings-item">
                <label>Total MSMEs:</label>
                <span id="settings-total-msmes">0</span>
              </div>
              <div class="settings-item">
                <label>Total Events:</label>
                <span id="settings-total-events">0</span>
              </div>
              <div class="settings-item">
                <label>Total Bulletins:</label>
                <span id="settings-total-bulletins">0</span>
              </div>
            </div>
            <div class="settings-card">
              <h3>Data Management</h3>
              <button onclick="adminDashboard.exportData()" class="btn-admin">
                <i class="fas fa-download"></i> Export All Data
              </button>
              <button onclick="adminDashboard.clearAllData()" class="btn-admin btn-danger">
                <i class="fas fa-trash"></i> Clear All Data (Danger)
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script type="module">
    import { getCurrentUser, login, isAdmin } from '/js/auth-localstorage.js';
    import { ensureAdminAccount } from '/js/admin.js';

    // Ensure admin account exists
    ensureAdminAccount();

    // Check if already logged in as admin
    function checkAdminLogin() {
      const user = getCurrentUser();
      if (user && isAdmin()) {
        // Show dashboard, hide login
        document.getElementById('admin-login-container').style.display = 'none';
        document.getElementById('admin-dashboard-container').style.display = 'block';
        // Initialize dashboard
        import('/js/admin.js').then(module => {
          if (module.adminDashboard) {
            module.adminDashboard.init();
          }
        });
      } else {
        // Show login, hide dashboard
        // If user is logged in but not admin, logout first
        if (user && !isAdmin()) {
          import('/js/auth-localstorage.js').then(module => {
            module.logout();
          });
        }
        document.getElementById('admin-login-container').style.display = 'flex';
        document.getElementById('admin-dashboard-container').style.display = 'none';
      }
    }

    // Handle login form submission
    document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('admin-email').value.trim();
      const password = document.getElementById('admin-password').value;
      const errorDiv = document.getElementById('admin-login-error');
      const loginBtn = document.getElementById('admin-login-btn');

      errorDiv.style.display = 'none';
      loginBtn.disabled = true;
      loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';

      try {
        const result = login(email, password);
        if (result && result.user && result.user.role === 'admin') {
          // Success - reload to show dashboard
          window.location.reload();
        } else {
          throw new Error('Invalid admin credentials');
        }
      } catch (error) {
        errorDiv.textContent = error.message || 'Invalid email or password';
        errorDiv.style.display = 'block';
        loginBtn.disabled = false;
        loginBtn.innerHTML = 'Login';
      }
    });

    // Check on page load
    checkAdminLogin();
  </script>
  <script type="module" src="/js/admin.js"></script>
</body>
</html>
