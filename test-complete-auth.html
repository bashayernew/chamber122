<!DOCTYPE html>
<html>
<head>
  <title>Complete Auth Test</title>
  <meta name="supabase-url" content="https://gidbvemmqffogakcepka.supabase.co">
  <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w">
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
    .test-section { margin: 2rem 0; padding: 1.5rem; border: 1px solid #ddd; border-radius: 8px; }
    .form-group { margin: 1rem 0; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
    .form-group input { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    .btn { padding: 0.75rem 1.5rem; margin: 0.5rem; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-success { background: #10b981; color: white; }
    .btn-danger { background: #ef4444; color: white; }
    .status { padding: 1rem; margin: 1rem 0; border-radius: 4px; }
    .success { background: #d1fae5; color: #065f46; }
    .error { background: #fee2e2; color: #991b1b; }
    .info { background: #dbeafe; color: #1e40af; }
    .tabs { display: flex; margin-bottom: 1rem; }
    .tab { padding: 0.5rem 1rem; background: #f3f4f6; border: 1px solid #d1d5db; cursor: pointer; }
    .tab.active { background: #3b82f6; color: white; }
    .panel { display: none; }
    .panel.active { display: block; }
  </style>
</head>
<body>
  <h1>Complete Auth Flow Test</h1>
  
  <div class="tabs">
    <div class="tab active" onclick="showPanel('signup')">Sign Up</div>
    <div class="tab" onclick="showPanel('login')">Login</div>
    <div class="tab" onclick="showPanel('status')">Auth Status</div>
  </div>
  
  <!-- Signup Panel -->
  <div id="signup-panel" class="panel active">
    <div class="test-section">
      <h2>Test Sign Up</h2>
      <form id="test-signup">
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="signup-email" placeholder="test@example.com" required>
        </div>
        <div class="form-group">
          <label>Password:</label>
          <input type="password" id="signup-password" placeholder="password123" required>
        </div>
        <div class="form-group">
          <label>Confirm Password:</label>
          <input type="password" id="signup-confirm-password" placeholder="password123" required>
        </div>
        <button type="submit" class="btn btn-primary">Test Sign Up</button>
      </form>
    </div>
  </div>
  
  <!-- Login Panel -->
  <div id="login-panel" class="panel">
    <div class="test-section">
      <h2>Test Login</h2>
      <form id="test-login">
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="login-email" placeholder="test@example.com" required>
        </div>
        <div class="form-group">
          <label>Password:</label>
          <input type="password" id="login-password" placeholder="password123" required>
        </div>
        <button type="submit" class="btn btn-success">Test Login</button>
      </form>
    </div>
  </div>
  
  <!-- Status Panel -->
  <div id="status-panel" class="panel">
    <div class="test-section">
      <h2>Current Auth Status</h2>
      <div id="auth-status" class="status info">Loading...</div>
      <button id="refresh-status" class="btn btn-primary">Refresh Status</button>
      <button id="sign-out" class="btn btn-danger">Sign Out</button>
    </div>
  </div>
  
  <div class="test-section">
    <h2>Console Test</h2>
    <p>Open browser console and run:</p>
    <code>
      (await supabase.auth.getUser()).data.user?.id
    </code>
  </div>

  <script type="module">
    import { supabase, getCurrentAccountState } from '/js/supabase-client.js';
    import { signupWithEmailPassword, signInWithPassword } from '/js/auth-signup-utils.js';
    
    // Make supabase available globally for console testing
    window.supabase = supabase;
    
    const authStatus = document.getElementById('auth-status');
    const refreshBtn = document.getElementById('refresh-status');
    const signOutBtn = document.getElementById('sign-out');
    
    async function updateAuthStatus() {
      try {
        const { signedIn, user } = await getCurrentAccountState();
        if (signedIn && user) {
          authStatus.className = 'status success';
          authStatus.innerHTML = `
            <strong>Signed In</strong><br>
            Email: ${user.email}<br>
            ID: ${user.id}<br>
            Created: ${new Date(user.created_at).toLocaleString()}
          `;
        } else {
          authStatus.className = 'status info';
          authStatus.textContent = 'Not signed in';
        }
      } catch (error) {
        authStatus.className = 'status error';
        authStatus.textContent = 'Error: ' + error.message;
      }
    }
    
    // Initial status update
    updateAuthStatus();
    
    // Listen for auth state changes
    supabase.auth.onAuthStateChange((event, session) => {
      console.log('Auth state changed:', event, session?.user?.email);
      updateAuthStatus();
    });
    
    // Event listeners
    refreshBtn.addEventListener('click', updateAuthStatus);
    
    signOutBtn.addEventListener('click', async () => {
      try {
        await supabase.auth.signOut();
        updateAuthStatus();
        alert('Signed out successfully!');
      } catch (error) {
        alert('Sign out error: ' + error.message);
      }
    });
    
    // Sign up form
    document.getElementById('test-signup').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const confirmPassword = document.getElementById('signup-confirm-password').value;
      
      if (password !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      
      const btn = e.target.querySelector('button[type="submit"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
      btn.disabled = true;
      
      try {
        const { requiresConfirm } = await signupWithEmailPassword(email, password);
        if (requiresConfirm) {
          alert('Account created! Check your email for confirmation link.');
        } else {
          alert('Account created and signed in!');
        }
        updateAuthStatus();
      } catch (error) {
        alert('Sign up error: ' + error.message);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    });
    
    // Sign in form
    document.getElementById('test-login').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      
      const btn = e.target.querySelector('button[type="submit"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
      btn.disabled = true;
      
      try {
        await signInWithPassword(email, password);
        alert('Signed in successfully!');
        updateAuthStatus();
      } catch (error) {
        alert('Sign in error: ' + error.message);
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    });
    
    // Tab switching
    window.showPanel = function(panelName) {
      // Hide all panels
      document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      
      // Show selected panel
      document.getElementById(panelName + '-panel').classList.add('active');
      event.target.classList.add('active');
    };
  </script>
</body>
</html>







