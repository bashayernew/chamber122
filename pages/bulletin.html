<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulletin Details - Chamber122</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0a0a0a] text-white">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div id="bulletin-details" class="space-y-6">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-4 text-gray-400">Loading bulletin details...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { supabase } from '/assets/js/supabase-client.global.js';

        async function loadBulletinDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const bulletinId = urlParams.get('id');
            
            if (!bulletinId) {
                document.getElementById('bulletin-details').innerHTML = `
                    <div class="text-center py-12">
                        <h1 class="text-2xl font-bold text-red-400 mb-4">Bulletin Not Found</h1>
                        <p class="text-gray-400">No bulletin ID provided.</p>
                        <a href="/" class="inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Go Home</a>
                    </div>
                `;
                return;
            }

            try {
                const { data: bulletin, error } = await supabase
                    .from('bulletins')
                    .select('*')
                    .eq('id', bulletinId)
                    .single();

                if (error || !bulletin) {
                    throw new Error('Bulletin not found');
                }

                renderBulletinDetails(bulletin);
            } catch (error) {
                console.error('Error loading bulletin:', error);
                document.getElementById('bulletin-details').innerHTML = `
                    <div class="text-center py-12">
                        <h1 class="text-2xl font-bold text-red-400 mb-4">Bulletin Not Found</h1>
                        <p class="text-gray-400">The requested bulletin could not be found.</p>
                        <a href="/" class="inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Go Home</a>
                    </div>
                `;
            }
        }

        function renderBulletinDetails(bulletin) {
            const createdDate = bulletin.created_at ? new Date(bulletin.created_at).toLocaleString() : 'Unknown';
            const endDate = bulletin.end_at ? new Date(bulletin.end_at).toLocaleString() : null;
            
            // Format address and contact as specified
            const addr = [bulletin.governorate, bulletin.area, bulletin.street].filter(Boolean).join(', ');
            const extras = [bulletin.block && `Block ${bulletin.block}`, bulletin.floor && `Floor ${bulletin.floor}`].filter(Boolean).join(' ‚Ä¢ ');
            const contact = [bulletin.contact_phone, bulletin.contact_email].filter(Boolean).join(' ‚Ä¢ ');

            document.getElementById('bulletin-details').innerHTML = `
                <div class="bg-[#0f0f0f] rounded-2xl border border-[#222] overflow-hidden">
                    ${bulletin.cover_image_url || bulletin.cover_url ? `
                        <div class="h-64 md:h-80 bg-[#111] overflow-hidden">
                            <img src="${bulletin.cover_image_url || bulletin.cover_url}" class="w-full h-full object-cover" alt="${bulletin.title}">
                        </div>
                    ` : ''}
                    
                    <div class="p-6 md:p-8 space-y-6">
                        <div class="flex items-center gap-2">
                            <span class="px-3 py-1 text-sm rounded-full bg-[#1f2937] text-[#e5e7eb]">Bulletin</span>
                            <span class="text-sm text-[#9ca3af]">${createdDate}${endDate ? ' ‚Ä¢ Deadline: ' + endDate : ''}</span>
                        </div>
                        
                        <h1 class="text-3xl md:text-4xl font-bold text-white">${bulletin.title || 'Untitled Bulletin'}</h1>
                        
                        ${bulletin.description || bulletin.body ? `
                            <div class="prose prose-invert max-w-none">
                                <p class="text-[#d1d5db] text-lg leading-relaxed whitespace-pre-wrap">${bulletin.description || bulletin.body}</p>
                            </div>
                        ` : ''}
                        
                        ${addr ? `
                            <div class="flex items-start gap-3">
                                <span class="text-[#9ca3af] mt-1">üìç</span>
                                <div>
                                    <h3 class="font-semibold text-white mb-1">Location</h3>
                                    <p class="text-[#d1d5db]">${addr}</p>
                                    ${extras ? `<p class="text-[#9ca3af] text-sm mt-1">${extras}</p>` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${contact ? `
                            <div class="flex items-start gap-3">
                                <span class="text-[#9ca3af] mt-1">‚òéÔ∏è</span>
                                <div>
                                    <h3 class="font-semibold text-white mb-1">Contact</h3>
                                    <p class="text-[#d1d5db]">${contact}</p>
                                </div>
                            </div>
                        ` : ''}
                        
                        ${bulletin.link ? `
                            <div class="flex items-start gap-3">
                                <span class="text-[#9ca3af] mt-1">üîó</span>
                                <div>
                                    <h3 class="font-semibold text-white mb-1">More Information</h3>
                                    <a href="${bulletin.link}" target="_blank" rel="noopener noreferrer" class="text-[#93c5fd] hover:text-[#60a5fa] underline">
                                        ${bulletin.link}
                                    </a>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="pt-6 border-t border-[#222]">
                            <a href="/" class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                ‚Üê Back to Bulletins
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load bulletin details when page loads
        document.addEventListener('DOMContentLoaded', loadBulletinDetails);
    </script>
</body>
</html>
