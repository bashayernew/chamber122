<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Datetime Form - Chamber122</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
    .test-button { background: #6f75ff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    .test-button:hover { background: #5a5fcf; }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .info { color: #2196F3; }
    .log { background: #2a2a2a; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    .form-group { margin: 10px 0; }
    .form-group label { display: block; margin-bottom: 5px; }
    .form-group input { 
      width: 100%; padding: 8px; border: 1px solid #555; border-radius: 4px; background: #333; color: #fff; 
    }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; }
    .modal-content { background: #1a1a1a; margin: 50px auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 8px; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .close { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ðŸ§ª Datetime Form Test</h1>
  
  <div class="test-section">
    <h2>1. Form Input Test</h2>
    <button class="test-button" onclick="testFormInputs()">Test Form Inputs</button>
    <div id="input-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>2. Datetime Validation Test</h2>
    <button class="test-button" onclick="testDatetimeValidation()">Test Datetime Validation</button>
    <div id="validation-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>3. Event Form Test</h2>
    <button class="test-button" onclick="openEventForm()">Open Event Form</button>
    <div id="form-results" class="log"></div>
  </div>

  <!-- Event Form Modal -->
  <div id="event-form-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create Event (Datetime Test)</h2>
        <button class="close" onclick="closeEventForm()">&times;</button>
      </div>
      
      <form id="event-creation-form">
        <div class="form-group">
          <label for="event-title">Event Title *</label>
          <input type="text" id="event-title" name="title" required>
        </div>
        
        <div class="form-group">
          <label for="event-type">Event Type *</label>
          <select id="event-type" name="type" required>
            <option value="">Select type...</option>
            <option value="networking">Networking</option>
            <option value="training">Training</option>
            <option value="workshop">Workshop</option>
            <option value="conference">Conference</option>
            <option value="exhibition">Exhibition</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="event-description">Description</label>
          <textarea id="event-description" name="description" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="event-location">Location</label>
          <input type="text" id="event-location" name="location">
        </div>
        
        <div class="form-group">
          <label for="event-start">Start Date & Time *</label>
          <input type="datetime-local" id="event-start" name="start_at" required>
        </div>
        
        <div class="form-group">
          <label for="event-end">End Date & Time</label>
          <input type="datetime-local" id="event-end" name="end_at">
        </div>
        
        <div class="form-group">
          <label for="contact-name">Contact Name</label>
          <input type="text" id="contact-name" name="contact_name">
        </div>
        
        <div class="form-group">
          <label for="contact-email">Contact Email</label>
          <input type="email" id="contact-email" name="contact_email">
        </div>
        
        <div class="form-group">
          <label for="contact-phone">Contact Phone</label>
          <input type="tel" id="contact-phone" name="contact_phone">
        </div>
        
        <div class="form-group">
          <label for="event-link">Event Link</label>
          <input type="url" id="event-link" name="link">
        </div>
        
        <div class="form-group">
          <label for="event-cover-input">Cover Image</label>
          <input type="file" id="event-cover-input" name="cover_image" accept="image/*">
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="event-published" name="is_published"> Publish immediately
          </label>
        </div>
        
        <div id="event-status-message" style="display: none; padding: 10px; margin: 10px 0; border-radius: 4px;"></div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="button" id="cancel-event" onclick="closeEventForm()">Cancel</button>
          <button type="button" id="submit-event" onclick="handleEventSubmission()">Create Event</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Include the classic scripts in correct order -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/supabase-client.global.js?v=1"></script>
  <script src="/js/i18n.js?v=1"></script>
  <script src="/js/language-switcher.js?v=1"></script>
  <script src="/js/header-auth-slot.js?v=1"></script>
  <script src="/js/activities-list.js?v=1"></script>
  <script src="/js/event.js?v=1"></script>

  <script>
    function log(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString();
      element.textContent += `[${timestamp}] ${message}\n`;
      element.className = `log ${type}`;
    }
    
    function testFormInputs() {
      log('input-results', 'Testing datetime form inputs...', 'info');
      
      const inputs = [
        { id: 'event-start', type: 'datetime-local', required: true },
        { id: 'event-end', type: 'datetime-local', required: false }
      ];
      
      let allFound = true;
      inputs.forEach(input => {
        const element = document.getElementById(input.id);
        if (element) {
          if (element.type === input.type) {
            log('input-results', `âœ… ${input.id} found with correct type (${input.type})`, 'success');
          } else {
            log('input-results', `âŒ ${input.id} has wrong type: ${element.type} (expected ${input.type})`, 'error');
            allFound = false;
          }
          
          if (input.required && element.required) {
            log('input-results', `âœ… ${input.id} correctly marked as required`, 'success');
          } else if (!input.required && !element.required) {
            log('input-results', `âœ… ${input.id} correctly marked as optional`, 'success');
          } else {
            log('input-results', `âŒ ${input.id} required attribute mismatch`, 'error');
            allFound = false;
          }
        } else {
          log('input-results', `âŒ ${input.id} not found`, 'error');
          allFound = false;
        }
      });
      
      if (allFound) {
        log('input-results', 'ðŸŽ‰ All datetime inputs configured correctly!', 'success');
      } else {
        log('input-results', 'âš ï¸ Some datetime inputs have issues', 'error');
      }
    }
    
    function testDatetimeValidation() {
      log('validation-results', 'Testing datetime validation...', 'info');
      
      // Test with empty start date
      const startInput = document.getElementById('event-start');
      const endInput = document.getElementById('event-end');
      
      if (startInput && endInput) {
        // Clear inputs
        startInput.value = '';
        endInput.value = '';
        
        // Test validation
        if (!startInput.value) {
          log('validation-results', 'âœ… Start date validation: Empty value detected', 'success');
        } else {
          log('validation-results', 'âŒ Start date validation: Should be empty', 'error');
        }
        
        // Test with valid datetime
        const now = new Date();
        const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
        
        startInput.value = now.toISOString().slice(0, 16);
        endInput.value = tomorrow.toISOString().slice(0, 16);
        
        if (startInput.value && endInput.value) {
          log('validation-results', 'âœ… Datetime values set successfully', 'success');
          
          // Test ISO conversion
          const startISO = new Date(startInput.value).toISOString();
          const endISO = new Date(endInput.value).toISOString();
          
          log('validation-results', `Start ISO: ${startISO}`, 'info');
          log('validation-results', `End ISO: ${endISO}`, 'info');
          
          if (endISO > startISO) {
            log('validation-results', 'âœ… End date is after start date', 'success');
          } else {
            log('validation-results', 'âŒ End date should be after start date', 'error');
          }
        } else {
          log('validation-results', 'âŒ Failed to set datetime values', 'error');
        }
      } else {
        log('validation-results', 'âŒ Datetime inputs not found', 'error');
      }
    }
    
    function testEventForm() {
      log('form-results', 'Testing event form functionality...', 'info');
      
      if (typeof window.openEventForm === 'function') {
        log('form-results', 'âœ… openEventForm function available', 'success');
        
        try {
          window.openEventForm();
          log('form-results', 'âœ… Event form opened successfully', 'success');
        } catch (error) {
          log('form-results', `âŒ Error opening event form: ${error.message}`, 'error');
        }
      } else {
        log('form-results', 'âŒ openEventForm function not available', 'error');
      }
    }
    
    // Auto-run tests on page load
    document.addEventListener('DOMContentLoaded', () => {
      log('input-results', 'Datetime form test page loaded', 'info');
      log('input-results', 'Click the test buttons to run individual tests', 'info');
      
      // Auto-run input test
      setTimeout(() => {
        testFormInputs();
        testDatetimeValidation();
      }, 1000);
    });
  </script>
</body>
</html>
