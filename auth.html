<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Login / Sign Up | Chamber122</title>
  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>
  <link rel="stylesheet" href="css/style.css?v=18">
  <link rel="stylesheet" href="css/auth.css?v=18">
  <link rel="stylesheet" href="/css/header.css?v=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script type="module" src="/js/supabase-client.js?v=20"></script>
  <script type="module" src="/js/site-header.js?v=1"></script>
</head>
<body>
  <div id="site-header"></div>

  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo site-logo">
        <img src="images/logo.png" alt="Chamber122 Logo">

      </a>
      <div class="nav-menu">
        <a href="index.html" class="nav-link" data-i18n="nav.home">Home</a>
        <a href="directory.html" class="nav-link" data-i18n="nav.directory">Directory</a>
        <a href="events.html" class="nav-link" data-i18n="nav.events">Events</a>
        <a href="bulletin.html" class="nav-link" data-i18n="nav.bulletin">Bulletin</a>
        <a href="about.html" class="nav-link" data-i18n="nav.about">About</a>
        <a href="contact.html" class="nav-link" data-i18n="nav.contact">Contact</a>
      </div>
      <div class="nav-actions">
        <!-- Language toggle -->
        <span id="lang-toggle" class="lang-toggle" aria-label="Language">
          <button data-lang="en" class="lang-btn" data-testid="lang-switch-en">EN</button> |
          <button data-lang="ar" class="lang-btn" data-testid="lang-switch-ar">AR</button>
        </span>
        <!-- Auth CTAs (shown when NOT logged in) -->
        <div id="auth-cta" class="flex items-center gap-3" data-testid="auth-cta">
          <a href="auth.html#login" class="btn btn-ghost text-sm" data-testid="login-cta" data-i18n="nav.login">Login</a>
          <a href="auth.html#signup" class="btn btn-primary text-sm px-4 py-2 rounded-2xl shadow-sm" data-testid="signup-cta" data-i18n="nav.signup">
            Sign Up & Get Listed
          </a>
        </div>

        <!-- Account menu (shown ONLY when logged in) -->
        <div id="account-menu" class="relative hidden" data-testid="account-menu">
          <button id="account-btn" class="btn btn-outline flex items-center gap-2">
            <img id="account-avatar" src="" alt="" class="h-7 w-7 rounded-full object-cover hidden">
            <span id="account-name" data-i18n="nav.account">Account</span>
            <svg class="h-4 w-4 opacity-70" viewBox="0 0 20 20"><path d="M5 7l5 6 5-6"/></svg>
          </button>
          <div id="account-dropdown" class="menu hidden">
            <a href="owner-activities.html" data-testid="menu-my-activities" data-i18n="nav.myActivities">My Activities</a>
            <a href="admin-dashboard.html" id="menu-admin" class="hidden" data-testid="menu-admin" data-i18n="nav.admin">Admin Panel</a>
            <a href="#" id="btn-logout" data-testid="logout" data-i18n="nav.logout">Logout</a>
          </div>
        </div>
      </div>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu" title="Toggle mobile menu">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    <div class="mobile-menu" id="mobile-menu">
      <a href="index.html" class="mobile-link">Home</a>
      <a href="directory.html" class="mobile-link">Directory</a>
      <a href="events.html" class="mobile-link">Events</a>
      <a href="bulletin.html" class="mobile-link">Bulletin</a>
      <a href="about.html" class="mobile-link">About</a>
      <a href="contact.html" class="mobile-link">Contact</a>
      <div class="mobile-divider"></div>
      <a href="owner.html" class="mobile-link">
        <i class="fas fa-building"></i>
        My Business
      </a>
      <a href="owner-activities.html" class="mobile-link">
        <i class="fas fa-calendar-alt"></i>
        My Activities
      </a>
      <a href="admin.html" class="mobile-link">
        <i class="fas fa-cog"></i>
        Admin Panel
      </a>
      <div class="mobile-divider"></div>
      <a href="auth.html" class="mobile-link">
        <i class="fas fa-sign-in-alt"></i>
        Login
      </a>
      <a href="get-listed.html" class="mobile-link">
        <i class="fas fa-user-plus"></i>
        Sign Up & Get Listed
      </a>
    </div>
    </div>
  </nav>

  <div class="auth-container">
    <div class="auth-card">
      <!-- Sticky Tab Navigation -->
      <div class="auth-tabs" role="tablist" data-testid="auth-tabs">
        <button class="auth-tab" id="tab-login" role="tab" aria-controls="panel-login" data-target="login" data-i18n="auth.loginTab">Login</button>
        <button class="auth-tab" id="tab-signup" role="tab" aria-controls="panel-signup" data-target="signup" data-i18n="auth.signupTab">Sign Up & Get Listed</button>
      </div>

      <!-- Login Panel -->
      <section id="panel-login" role="tabpanel" aria-labelledby="tab-login">
        <div class="auth-form">
          <h3 class="form-title" data-i18n="auth.loginTitle">Login to Your Account</h3>
          
          <!-- Email + Password Login -->
          <form id="loginEmailForm" class="auth-form-section">
            <div class="form-group">
              <label for="login-email" class="form-label" data-i18n="auth.email">Email</label>
              <input type="email" id="login-email" class="form-input" data-testid="login-email" placeholder="your@email.com" required>
            </div>
            
            <div class="form-group">
              <label for="login-password" class="form-label" data-i18n="auth.password">Password</label>
              <div class="password-field">
                <input type="password" id="login-password" class="form-input" data-testid="login-password" placeholder="Enter your password" autocomplete="current-password" required>
                <button type="button" class="password-toggle" onclick="togglePassword('login-password')" aria-label="Toggle password visibility" title="Toggle password visibility">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            
            <button type="submit" id="login-submit" class="btn btn-primary" data-testid="login-submit" data-i18n="auth.logIn">Log In</button>
            <a id="forgotLink" href="#" class="forgot-link" data-i18n="auth.forgotPassword">Forgot password?</a>
          </form>

          <div class="form-divider">
            <span data-i18n="auth.or">or</span>
          </div>

          <!-- Phone OTP Login (Collapsible) -->
          <details id="phoneLoginBlock" class="phone-login-block">
            <summary class="phone-login-summary" data-i18n="auth.usePhoneInstead">Use phone instead</summary>
            <form id="loginPhoneForm" class="auth-form-section" autocomplete="one-time-code">
              <div class="form-group">
                <label for="login-phone" class="form-label" data-i18n="auth.phone">Phone Number</label>
                <input id="login-phone" type="tel" class="form-input" placeholder="+9655xxxxxxx" />
              </div>
              <div class="form-group">
                <button type="button" id="btnSendOtp" class="btn btn-outline" data-i18n="auth.sendCode">Send code</button>
              </div>
              <div class="form-group">
                <label for="login-phone-code" class="form-label" data-i18n="auth.verificationCode">Verification Code</label>
                <input id="login-phone-code" type="text" inputmode="numeric" autocomplete="one-time-code" class="form-input" placeholder="6-digit code" />
                <button type="button" id="btnVerifyOtp" class="btn btn-primary" data-i18n="auth.verifyAndLogin">Verify & Log in</button>
              </div>
            </form>
            <small class="otp-tip" data-i18n="auth.otpTip">Tip: On supported phones, the code may auto-fill.</small>
          </details>

          <div class="form-divider">
            <span data-i18n="auth.or">or</span>
          </div>

          <!-- Magic Link -->
          <details class="magic-link-block">
            <summary class="magic-link-summary" data-i18n="auth.getMagicLink">Or get a magic link to email</summary>
            <form id="magicForm" class="auth-form-section">
              <div class="form-group">
                <label for="magic-email" class="form-label" data-i18n="auth.email">Email</label>
                <input id="magic-email" type="email" class="form-input" placeholder="your@email.com" />
              </div>
              <button id="btnMagic" type="submit" class="btn btn-outline" data-i18n="auth.sendMagicLink">Send magic link</button>
            </form>
          </details>
        </div>
      </section>

      <!-- Signup Panel -->
      <section id="panel-signup" role="tabpanel" aria-labelledby="tab-signup">
        <form id="signup-form" class="auth-form" novalidate>
        <!-- Progress Bar -->
        <div class="signup-steps">
          <div class="step-progress">
            <div id="signup-progress" class="step-progress-bar"></div>
          </div>
          <div class="step-indicators">
            <div class="step-indicator active">1</div>
            <div class="step-indicator">2</div>
            <div class="step-indicator">3</div>
            <div class="step-indicator">4</div>
          </div>
        </div>

        <!-- All Steps Combined -->
        <div id="signup-form-all" class="signup-form-all">
          <h3 class="step-title" data-i18n="auth.step2Title">Business Information</h3>
          <p class="step-subtitle" data-i18n="auth.step2Subtitle">Tell us about your business</p>
          
          <div class="form-group">
            <label for="signup-name" class="form-label" data-i18n="auth.businessName">Business Name *</label>
            <input type="text" id="signup-name" class="form-input" data-testid="signup-name" data-label="Business Name" placeholder="Your business name" required>
          </div>
          
          <div class="form-group">
            <label for="signup-category" class="form-label" data-i18n="auth.category">Category *</label>
            <select id="signup-category" class="form-input form-select" data-testid="signup-category" data-label="Category" required>
              <option value="" data-i18n="auth.selectCategory">Select a category</option>
              <option value="food" data-i18n="auth.categories.food">Food & Beverage</option>
              <option value="fashion" data-i18n="auth.categories.fashion">Fashion & Beauty</option>
              <option value="cleaning" data-i18n="auth.categories.cleaning">Cleaning Services</option>
              <option value="tech" data-i18n="auth.categories.tech">Technology</option>
              <option value="home" data-i18n="auth.categories.home">Home Services</option>
              <option value="retail" data-i18n="auth.categories.retail">Retail</option>
              <option value="healthcare" data-i18n="auth.categories.healthcare">Healthcare</option>
              <option value="education" data-i18n="auth.categories.education">Education</option>
              <option value="other" data-i18n="auth.categories.other">Other</option>
            </select>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="signup-country" class="form-label" data-i18n="auth.country">Country *</label>
              <select id="signup-country" class="form-input form-select" data-testid="signup-country" data-label="Country" required>
                <option value="" data-i18n="auth.selectCountry">Select country</option>
                <option value="Kuwait" data-i18n="auth.countries.kuwait" selected>Kuwait</option>
              </select>
            </div>
            <div class="form-group">
              <label for="signup-city" class="form-label" data-i18n="auth.city">City *</label>
              <input type="text" id="signup-city" class="form-input" data-testid="signup-city" data-label="City" placeholder="Your city" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="signup-desc" class="form-label" data-i18n="auth.description">Short Description *</label>
            <textarea id="signup-desc" class="form-input form-textarea" data-testid="signup-desc" data-label="Short Description" data-validate="min:10" placeholder="Describe your business in 50-140 characters" required maxlength="140"></textarea>
            <div id="desc-counter" class="char-counter">0/140</div>
          </div>
          
        </div>

          <!-- Step 2: Business Details -->
          <h3 class="step-title" data-i18n="auth.step2Title">Business Details</h3>
          <p class="step-subtitle" data-i18n="auth.step2Subtitle">Additional business information</p>
          
          <div class="form-group">
            <label for="signup-whatsapp" class="form-label" data-i18n="auth.whatsapp">WhatsApp/Phone *</label>
            <input type="tel" id="signup-whatsapp" class="form-input" data-testid="signup-whatsapp" data-label="WhatsApp/Phone" data-validate="phone" placeholder="+965-12345678" required>
          </div>
          
          <div class="form-group">
            <label for="logo-file" class="form-label" data-i18n="auth.logo">Business Logo (Optional)</label>
            <div class="file-upload">
              <input type="file" id="logo-file" class="file-upload-input" data-testid="signup-logo" data-doc="logo" accept="image/*">
              <label for="logo-file" class="file-upload-label">
                <i class="fas fa-upload"></i>
                <span data-i18n="auth.uploadLogo">Upload Logo</span>
              </label>
              <div class="logo-upload-status" id="logo-upload-status" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 6px; color: #22c55e; font-size: 0.9rem;">
                <i class="fas fa-check-circle"></i>
                <span>Logo uploaded successfully!</span>
              </div>
              <img id="logo-preview" class="logo-preview hidden" alt="Logo preview" 
                   src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='320' height='180'><rect width='100%25' height='100%25' fill='%23222222'/><text x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23aaaaaa' font-family='Arial' font-size='16'>Logo preview</text></svg>"
                   onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22320%22 height=%22180%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23222222%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23aaaaaa%22 font-family=%22Arial%22 font-size=%2216%22>Logo preview</text></svg>'">
            </div>
          </div>
          

          <!-- Step 3: Required Documents -->
          <h3 class="step-title">Required Documents | Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h3>
          <p class="step-subtitle">Upload the required documents for verification | Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ­Ù‚Ù‚</p>
          
          <div class="documents-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <!-- Business License -->
            <div class="document-card" data-document="license" style="background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 12px; padding: 1.5rem;">
              <div class="document-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="color: white; font-size: 1.1rem; font-weight: 600; margin: 0;">Business License | Ø±Ø®ØµØ© Ø§Ù„Ø¹Ù…Ù„</h4>
                <div class="document-status" style="display: flex; align-items: center; gap: 0.5rem;">
                  <span class="status-icon" style="font-size: 1.2rem; color: #9ca3af;">ğŸ“„</span>
                  <span class="status-text" data-upload-status="license" style="color: #9ca3af; font-size: 0.9rem;">Required</span>
                </div>
              </div>
              <div class="document-upload">
                <input type="file" id="license-file" accept=".pdf,.jpg,.jpeg,.png" class="file-input" data-doc="license" style="display: none;">
                <label for="license-file" class="file-label" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 2rem; border: 2px dashed rgba(212, 175, 55, 0.5); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-align: center;">
                  <span class="file-icon" style="font-size: 2rem; color: #6b7280;">ğŸ“„</span>
                  <span class="file-text" style="color: #9ca3af; font-weight: 500;">Choose File | Ø§Ø®ØªØ± Ù…Ù„Ù</span>
                  <span style="color: #6b7280; font-size: 0.8rem;">JPG, PNG, PDF (max 25MB)</span>
                </label>
                <div class="upload-progress" id="license-progress" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; color: #3b82f6; font-size: 0.9rem;">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Uploading...</span>
                </div>
              </div>
              <div class="document-preview" id="license-preview" style="display: none;">
                <a href="#" class="file-link" target="_blank" style="color: #10b981; text-decoration: none; font-weight: 500;">View File | Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>
                <button type="button" class="remove-file" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-left: 1rem;">Remove | Ø¥Ø²Ø§Ù„Ø©</button>
              </div>
            </div>

            <!-- Articles of Incorporation -->
            <div class="document-card" data-document="incorporation" style="background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 12px; padding: 1.5rem;">
              <div class="document-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="color: white; font-size: 1.1rem; font-weight: 600; margin: 0;">Articles of Incorporation | Ø¹Ù‚Ø¯ Ø§Ù„ØªØ£Ø³ÙŠØ³</h4>
                <div class="document-status" style="display: flex; align-items: center; gap: 0.5rem;">
                  <span class="status-icon" style="font-size: 1.2rem; color: #9ca3af;">ğŸ“„</span>
                  <span class="status-text" data-upload-status="articles" style="color: #9ca3af; font-size: 0.9rem;">Required</span>
                </div>
              </div>
              <div class="document-upload">
                <input type="file" id="incorporation-file" accept=".pdf,.jpg,.jpeg,.png" class="file-input" data-doc="articles" style="display: none;">
                <label for="incorporation-file" class="file-label" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 2rem; border: 2px dashed rgba(212, 175, 55, 0.5); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-align: center;">
                  <span class="file-icon" style="font-size: 2rem; color: #6b7280;">ğŸ“„</span>
                  <span class="file-text" style="color: #9ca3af; font-weight: 500;">Choose File | Ø§Ø®ØªØ± Ù…Ù„Ù</span>
                  <span style="color: #6b7280; font-size: 0.8rem;">JPG, PNG, PDF (max 25MB)</span>
                </label>
                <div class="upload-progress" id="articles-progress" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; color: #3b82f6; font-size: 0.9rem;">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Uploading...</span>
                </div>
              </div>
              <div class="document-preview" id="incorporation-preview" style="display: none;">
                <a href="#" class="file-link" target="_blank" style="color: #10b981; text-decoration: none; font-weight: 500;">View File | Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>
                <button type="button" class="remove-file" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-left: 1rem;">Remove | Ø¥Ø²Ø§Ù„Ø©</button>
              </div>
            </div>

            <!-- Signature Authorization -->
            <div class="document-card" data-document="signature_auth" style="background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 12px; padding: 1.5rem;">
              <div class="document-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="color: white; font-size: 1.1rem; font-weight: 600; margin: 0;">Signature Authorization | ØªÙÙˆÙŠØ¶ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</h4>
                <div class="document-status" style="display: flex; align-items: center; gap: 0.5rem;">
                  <span class="status-icon" style="font-size: 1.2rem; color: #9ca3af;">ğŸ“„</span>
                  <span class="status-text" data-upload-status="signature_auth" style="color: #9ca3af; font-size: 0.9rem;">Required</span>
                </div>
              </div>
              <div class="document-upload">
                <input type="file" id="signature-file" accept=".pdf,.jpg,.jpeg,.png" class="file-input" data-doc="signature_auth" style="display: none;">
                <label for="signature-file" class="file-label" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 2rem; border: 2px dashed rgba(212, 175, 55, 0.5); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-align: center;">
                  <span class="file-icon" style="font-size: 2rem; color: #6b7280;">ğŸ“„</span>
                  <span class="file-text" style="color: #9ca3af; font-weight: 500;">Choose File | Ø§Ø®ØªØ± Ù…Ù„Ù</span>
                  <span style="color: #6b7280; font-size: 0.8rem;">JPG, PNG, PDF (max 25MB)</span>
                </label>
                <div class="upload-progress" id="signature_auth-progress" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; color: #3b82f6; font-size: 0.9rem;">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Uploading...</span>
                </div>
              </div>
              <div class="document-preview" id="signature-preview" style="display: none;">
                <a href="#" class="file-link" target="_blank" style="color: #10b981; text-decoration: none; font-weight: 500;">View File | Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>
                <button type="button" class="remove-file" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-left: 1rem;">Remove | Ø¥Ø²Ø§Ù„Ø©</button>
              </div>
          </div>
          
            <!-- IBAN Certificate -->
            <div class="document-card" data-document="iban" style="background: rgba(17, 24, 39, 0.8); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 12px; padding: 1.5rem;">
              <div class="document-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="color: white; font-size: 1.1rem; font-weight: 600; margin: 0;">IBAN Certificate | Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù€IBAN</h4>
                <div class="document-status" style="display: flex; align-items: center; gap: 0.5rem;">
                  <span class="status-icon" style="font-size: 1.2rem; color: #9ca3af;">ğŸ“„</span>
                  <span class="status-text" data-upload-status="iban" style="color: #9ca3af; font-size: 0.9rem;">Required</span>
                </div>
              </div>
              <div class="document-upload">
                <input type="file" id="iban-file" accept=".pdf,.jpg,.jpeg,.png" class="file-input" data-doc="iban" style="display: none;">
                <label for="iban-file" class="file-label" style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 2rem; border: 2px dashed rgba(212, 175, 55, 0.5); border-radius: 8px; cursor: pointer; transition: all 0.3s ease; text-align: center;">
                  <span class="file-icon" style="font-size: 2rem; color: #6b7280;">ğŸ“„</span>
                  <span class="file-text" style="color: #9ca3af; font-weight: 500;">Choose File | Ø§Ø®ØªØ± Ù…Ù„Ù</span>
                  <span style="color: #6b7280; font-size: 0.8rem;">JPG, PNG, PDF (max 25MB)</span>
                </label>
                <div class="upload-progress" id="iban-progress" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; color: #3b82f6; font-size: 0.9rem;">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Uploading...</span>
                </div>
              </div>
              <div class="document-preview" id="iban-preview" style="display: none;">
                <a href="#" class="file-link" target="_blank" style="color: #10b981; text-decoration: none; font-weight: 500;">View File | Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a>
                <button type="button" class="remove-file" style="background: #ef4444; color: white; border: none; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-left: 1rem;">Remove | Ø¥Ø²Ø§Ù„Ø©</button>
              </div>
            </div>
          </div>
          

          <!-- Step 4: Email & Password -->
          <h3 class="step-title" data-i18n="auth.step4Title">Account Credentials</h3>
          <p class="step-subtitle" data-i18n="auth.step4Subtitle">Create your login credentials</p>
          
          <div class="form-group">
            <label for="signup-email" class="form-label" data-i18n="auth.email">Email Address *</label>
            <input type="email" id="signup-email" class="form-input" data-testid="signup-email" data-label="Email" data-validate="email" placeholder="your@email.com" required>
          </div>
          
          <div class="form-group">
            <label for="signup-phone" class="form-label" data-i18n="auth.phone">Phone Number (Optional)</label>
            <input type="tel" id="signup-phone" class="form-input" data-testid="signup-phone" data-label="Phone" placeholder="+9655xxxxxxx" />
            <small class="form-help" data-i18n="auth.phoneHelp">Add your phone for SMS login option</small>
          </div>
          
          <div class="form-group">
            <label for="signup-password" class="form-label" data-i18n="auth.password">Password *</label>
            <input type="password" id="signup-password" class="form-input" data-testid="signup-password" data-label="Password" data-validate="min:8" placeholder="Create a strong password" autocomplete="new-password" required>
          </div>
          
          <div class="form-group">
            <label for="signup-confirm-password" class="form-label" data-i18n="auth.confirmPassword">Confirm Password *</label>
            <input type="password" id="signup-confirm-password" class="form-input" data-testid="signup-confirm-password" data-label="Confirm Password" placeholder="Confirm your password" autocomplete="new-password" required>
          </div>
          
          <div class="form-group">
            <div class="checkbox-group">
              <input type="checkbox" id="signup-terms" class="checkbox-input" data-label="Terms" required>
              <label for="signup-terms" class="checkbox-label" data-i18n="auth.acceptTerms">I accept the Terms and Conditions</label>
            </div>
          </div>
          
          <div class="form-navigation">
            <button type="button" id="btnCreateAccount" class="btn btn-primary" data-testid="signup-submit" data-i18n="auth.createAccount">Create My Account</button>
            <button type="button" id="btnCompleteSignup" class="btn btn-success" style="display: none;">Complete Signup</button>
          </div>
        </div>
        </form>
      </section>
    </div>
  </div>
        
  <!-- Compliance Disclaimer -->
        <div class="compliance-disclaimer" style="margin-top: 2rem; padding: 1.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; text-align: center;">
          <div class="disclaimer-content">
            <div class="disclaimer-icon" style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“‹</div>
            <h4 style="color: #60a5fa; margin-bottom: 0.5rem; font-weight: 600;">
              Document Review Process
              <span style="display: block; font-size: 0.9rem; font-weight: 400; color: #9ca3af; margin-top: 0.25rem;">
                Ø¹Ù…Ù„ÙŠØ© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
              </span>
            </h4>
            <p style="color: #d1d5db; margin-bottom: 0.5rem; font-size: 0.9rem;">
              All submitted documents will be reviewed by the admin team. You can log in and use your account normally while review is pending. If documents are incorrect, you'll be notified to update them. Failure to comply may result in deactivation.
            </p>
            <p style="color: #9ca3af; font-size: 0.85rem; margin: 0;">
              Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ù‚Ø¨Ù„ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©. Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©ØŒ Ø³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø±Ùƒ Ù„ØªØ­Ø¯ÙŠØ«Ù‡Ø§. Ø¹Ø¯Ù… Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„.
            </p>
          </div>
        </div>
      </section>
    </div>
  </div>


  <footer class="footer">
    <div class="footer-content">
      <div class="footer-brand">
        <img src="images/logo.png" alt="Chamber122" />
      </div>
      <div class="footer-section">
        <h3>Chamber122</h3>
        <p>Connecting Kuwait's MSMEs with opportunities for growth and success. Join our community today.</p>
      </div>
      
      <div class="footer-section">
        <h3>Quick Links</h3>
        <div class="quick-links">
          <ul class="quick-links-list">
            <li><a href="index.html">Home</a></li>
            <li><a href="directory.html">Directory</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="bulletin.html">Bulletin</a></li>
            <li><a href="get-listed.html">Get Listed</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-section">
        <h3>Connect</h3>
        <p><a href="https://instagram.com/chamber_122_kw"><i class="fab fa-instagram"></i> Instagram</a></p>
        <p><a href="https://www.tiktok.com/@chamber122"><i class="fab fa-tiktok"></i> TikTok</a></p>
        <p><a href="https://wa.me/96522396999"><i class="fab fa-whatsapp"></i> Phone</a></p>
        <p><a href="mailto:info@chamber122.com"><i class="fas fa-envelope"></i> info@chamber122.com</a></p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2025 Chamber122. All Rights Reserved. | Empowering Kuwait's MSMEs</p>
    </div>
  </footer>

  <script src="js/main.js?v=7"></script>
  <script type="module" src="./js/i18n.js"></script>
  <script type="module" src="js/config.js"></script>
  <script type="module" src="js/supabase-client.js?v=21"></script>
  <script type="module" src="js/auth-state-manager.js"></script>
  <script type="module" src="js/signup-utils.js"></script>
  <script type="module" src="js/signup-stepper.js"></script>
  <script type="module" src="js/file-upload.js"></script>
  <script type="module" src="js/storage.js"></script>
  <script type="module" src="js/file-validate.js"></script>
  <script type="module" src="js/upload-doc.js"></script>
  <script type="module" src="js/signup-and-upload.js"></script>
  <script type="module" src="js/auth-login.js?v=21"></script>
  <script type="module" src="js/auth-signup.js?v=21"></script>
  <script src="js/error-handler.js?v=21"></script>
  <script type="module" src="js/signup-with-documents.js?v=21"></script>
  <script type="module" src="js/account-completeness.js"></script>
  <script type="module">
    import { initSignupPage } from '/js/signup-with-documents.js';
    
    // Initialize signup page when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      initSignupPage();
    });
  </script>
  <!-- Import authentication scripts -->
  <script type="module" src="js/modal-login-required.js"></script>
  <script type="module" src="js/guest.js"></script>
  <script type="module">
    import {
      signupWithEmailPassword,
      loginWithEmailPassword,
      sendPhoneOtp,
      verifyPhoneOtp,
      sendEmailMagicLink
    } from '/js/auth-api.js?v=21';
    import { initNavAuthState } from '/js/nav-auth-state.js';
    
    // Initialize navbar auth state
    initNavAuthState();
    
    document.addEventListener('DOMContentLoaded', () => {
      // Debug: Log configuration on page load
      import('./js/config-dev.js?v=21').then(({ logConfig }) => {
        logConfig();
      });
      
      // LOGIN: email + password - handled by auth-login.js

      // FORGOT PASSWORD - handled by auth-login.js

      // LOGIN: phone OTP (only when user chooses it)
      document.querySelector('#btnSendOtp')?.addEventListener('click', async () => {
        const phone = document.querySelector('#login-phone').value.trim();
        if (!phone) { alert('Enter your phone'); return; }
        try {
          await sendPhoneOtp(phone);
          alert('Code sent by SMS.');
          // Try WebOTP auto-fill (best-effort)
          if ('OTPCredential' in window && navigator.credentials) {
            const ac = new AbortController(); setTimeout(()=>ac.abort(), 60000);
            try {
              const cred = await navigator.credentials.get({ otp:{ transport:['sms'] }, signal: ac.signal });
              if (cred?.code) document.querySelector('#login-phone-code').value = cred.code;
            } catch(_) {}
          }
        } catch (err) { alert(err.message); }
      });

      document.querySelector('#btnVerifyOtp')?.addEventListener('click', async () => {
        const phone = document.querySelector('#login-phone').value.trim();
        const code = document.querySelector('#login-phone-code').value.trim();
        if (!phone || !code) { alert('Enter phone and code'); return; }
        try {
          await verifyPhoneOtp({ phone, code });
          location.replace('/owner-activities.html');
        } catch (err) { alert(err.message); }
      });

      // SIGNUP: email + password (+ optional phone)
      document.querySelector('#signup-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.querySelector('#signup-email').value.trim();
        const pw = document.querySelector('#signup-password').value;
        const phone = (document.querySelector('#signup-phone').value || '').trim() || null;
        
        if (!email || !pw) {
          alert('Please fill in all required fields');
          return;
        }
        
        if (pw !== document.querySelector('#signup-confirm-password').value) {
          alert('Passwords do not match');
          return;
        }
        
        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
        btn.disabled = true;
        
        try {
          const r = await signupWithEmailPassword({ email, password: pw, phone });
          if (r.requiresConfirm) {
            alert('Account created. Check your email to confirm, then log in.');
          } else {
            location.replace('/owner-activities.html');
          }
        } catch (err) {
          if (String(err.message).includes('already exists')) {
            const go = confirm(err.message + '\nGo to login now?');
            if (go) {
              document.querySelector('#login-email').value = email;
              location.hash = '#login';
            }
          } else {
            alert(err.message);
          }
        } finally {
          btn.innerHTML = originalText;
          btn.disabled = false;
        }
      });

      // MAGIC LINK: optional
      document.querySelector('#magicForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.querySelector('#magic-email').value.trim()
                     || document.querySelector('#login-email').value.trim()
                     || document.querySelector('#signup-email').value.trim();
        if (!email) { alert('Enter email'); return; }
        try {
          await sendEmailMagicLink(email);
          alert('Magic link sent to your email.');
        } catch (err) { alert(err.message); }
      });
    });
  </script>
  <link rel="stylesheet" href="css/modal.css?v=18">
  
  <script>
    // Password toggle function
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      const toggle = field.parentNode.querySelector('.password-toggle i');
      
      if (field.type === 'password') {
        field.type = 'text';
        toggle.classList.remove('fa-eye');
        toggle.classList.add('fa-eye-slash');
      } else {
        field.type = 'password';
        toggle.classList.remove('fa-eye-slash');
        toggle.classList.add('fa-eye');
      }
    }

    // Handle URL hash routing
    document.addEventListener('DOMContentLoaded', function() {
      // Small delay to ensure all event listeners are set up
      setTimeout(() => {
        const hash = window.location.hash;
        if (hash === '#signup') {
          document.getElementById('tab-signup')?.click();
        } else if (hash === '#login') {
          document.getElementById('tab-login')?.click();
        }
      }, 100);
    });

    // Show reason if provided in URL
    const params = new URLSearchParams(location.search);
    const reason = params.get('reason');
    if (reason) {
      // Show reason in a banner at the top of the auth card
      const authCard = document.querySelector('.auth-card');
      if (authCard) {
        const reasonBanner = document.createElement('div');
        reasonBanner.style.cssText = 'background: rgba(255, 209, 102, 0.1); border: 1px solid #ffd166; border-radius: 8px; padding: 12px; margin-bottom: 16px; color: #ffd166;';
        reasonBanner.textContent = reason;
        authCard.insertBefore(reasonBanner, authCard.firstChild);
      }
    }
  </script>

  <!-- Old validation script removed - using signup-with-documents.js instead -->
  <!--
    (function () {
      // Configuration
      const CONFIG = {
        stepSelector: '.signup-step[data-step]',
        nextSelectors: '#signup-next-1, #signup-next-2, #signup-next-3, [data-next], button.next, .next-btn, #signup-next',
        backSelectors: '#btnBack, [data-back], button.back, .back-btn, .signup-back',
        maxSteps: 4
      };

      // Utility functions
      const $ = (selector, root = document) => root.querySelector(selector);
      const $$ = (selector, root = document) => Array.from(root.querySelectorAll(selector));

      // State management
      let currentStep = 1;
      let isInitialized = false;

      // Get current step element and number
      function getCurrentStep() {
        const steps = $$(CONFIG.stepSelector);
        const activeStep = steps.find(step => 
          !step.classList.contains('hidden') && 
          step.offsetParent !== null
        );
        
        if (activeStep) {
          const stepNum = parseInt(activeStep.dataset.step) || 1;
          return { element: activeStep, number: stepNum, allSteps: steps };
        }
        
        return { element: steps[0] || null, number: 1, allSteps: steps };
      }

      // Show step by number
      function showStep(stepNumber) {
        if (stepNumber < 1 || stepNumber > CONFIG.maxSteps) {
          console.warn(`[Stepper] Invalid step number: ${stepNumber}`);
          return;
        }

        const { allSteps } = getCurrentStep();
        
        // Hide all steps and show target step
        allSteps.forEach(step => {
          const isTarget = parseInt(step.dataset.step) === stepNumber;
          step.classList.toggle('hidden', !isTarget);
          step.classList.toggle('active', isTarget);
          
          // Manage required attributes
          patchRequiredAttributes(step, isTarget);
        });

        // Update step indicators
        updateStepIndicators(stepNumber);
        
        // Update progress bar
        updateProgressBar(stepNumber);
        
        // Update state
        currentStep = stepNumber;
        window.currentStep = stepNumber;
        
        console.log(`[Stepper] Now showing step ${stepNumber}`);
      }

      // Update step indicators
      function updateStepIndicators(stepNumber) {
        const indicators = $$('.step-indicator');
        indicators.forEach((indicator, index) => {
          const stepNum = index + 1;
          indicator.classList.remove('active', 'completed');
          
          if (stepNum === stepNumber) {
            indicator.classList.add('active');
          } else if (stepNum < stepNumber) {
            indicator.classList.add('completed');
          }
        });
      }

      // Update progress bar
      function updateProgressBar(stepNumber) {
        const progressBar = $('#signup-progress');
        if (progressBar) {
          const progress = (stepNumber / CONFIG.maxSteps) * 100;
          progressBar.style.width = `${progress}%`;
        }
      }

      // Patch required attributes to prevent hidden field validation
      function patchRequiredAttributes(stepElement, isVisible) {
        if (!stepElement) return;
        
        const inputs = $$('input, select, textarea', stepElement);
        inputs.forEach(input => {
          if (isVisible) {
            // Restore required if it was previously required
            if (input.dataset.wasRequired === 'true') {
              input.required = true;
              delete input.dataset.wasRequired;
            }
          } else {
            // Store and remove required to prevent validation blocking
            if (input.required) {
              input.dataset.wasRequired = 'true';
              input.required = false;
            }
          }
        });

        // Mark form as novalidate to prevent native validation
        const form = stepElement.closest('form');
        if (form) {
          form.setAttribute('novalidate', 'novalidate');
        }
      }

      // Get field value safely
      function getFieldValue(fieldId, root = document) {
        const field = $(`#${fieldId}`, root) || $(`[name="${fieldId}"]`, root);
        if (!field) return '';
        
        if (field.type === 'checkbox') {
          return field.checked;
        }
        
        return (field.value || '').trim();
      }

      // Validate step 1 (Business Information) - ONLY business fields, no WhatsApp
      function validateStep1(stepElement) {
        const name = getFieldValue('signup-name', stepElement);
        const category = getFieldValue('signup-category', stepElement);
        const country = getFieldValue('signup-country', stepElement);
        const city = getFieldValue('signup-city', stepElement);
        const description = getFieldValue('signup-desc', stepElement);

        console.log('[Stepper] Validating step 1 (business fields only):', {
          name, category, country, city, 
          description: description.substring(0, 20) + '...'
        });

        const nameValid = name.length >= 2;
        const categoryValid = category !== '';
        const countryValid = country !== '';
        const cityValid = city !== '';
        const descriptionValid = description.length >= 10; // Changed from 50 to 10

        const isValid = nameValid && categoryValid && countryValid && 
                       cityValid && descriptionValid;
        
        console.log('[Stepper] Step 1 validation result:', isValid);
        
        if (!isValid) {
          if (!nameValid) console.error('[Stepper] Business name must be at least 2 characters');
          if (!categoryValid) console.error('[Stepper] Category is required');
          if (!countryValid) console.error('[Stepper] Country is required');
          if (!cityValid) console.error('[Stepper] City is required');
          if (!descriptionValid) console.error('[Stepper] Description must be at least 10 characters');
        }

        return isValid;
      }

      // Validate step 2 (Business Details - WhatsApp required)
      function validateStep2(stepElement) {
        const whatsapp = getFieldValue('signup-whatsapp', stepElement);
        
        console.log('[Stepper] Validating step 2 (WhatsApp required):', {
          whatsapp: whatsapp ? '***' : 'empty'
        });

        const whatsappValid = whatsapp.length >= 5;
        
        console.log('[Stepper] Step 2 validation result:', whatsappValid);
        
        if (!whatsappValid) {
          console.error('[Stepper] WhatsApp/Phone is required (at least 5 characters)');
        }

        return whatsappValid;
      }

      // Validate step 3 (Required Documents)
      function validateStep3(stepElement) {
        // Check if all required documents are uploaded
        const requiredDocuments = ['license', 'incorporation', 'signature_auth', 'iban'];
        let uploadedCount = 0;
        
        requiredDocuments.forEach(docType => {
          const fileInput = document.getElementById(`${docType}-file`);
          if (fileInput && fileInput.files && fileInput.files.length > 0) {
            uploadedCount++;
          }
        });

        console.log('[Stepper] Validating step 3 (Documents):', {
          required: requiredDocuments.length,
          uploaded: uploadedCount
        });

        const isValid = uploadedCount === requiredDocuments.length;
        
        if (!isValid) {
          console.error('[Stepper] Please upload all required documents');
        }

        return isValid;
      }

      // Validate step 4 (Account Credentials)
      function validateStep4(stepElement) {
        const email = getFieldValue('signup-email', stepElement);
        const password = getFieldValue('signup-password', stepElement);
        const confirmPassword = getFieldValue('signup-confirm-password', stepElement);
        const terms = getFieldValue('signup-terms', stepElement);

        console.log('[Stepper] Validating step 4:', {
          email: email ? '***@***' : 'empty',
          password: password ? '***' : 'empty',
          confirmPassword: confirmPassword ? '***' : 'empty',
          terms
        });

        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const emailValid = emailRegex.test(email);
        
        // Password validation
        const passwordValid = password.length >= 6;
        
        // Password match validation
        const passwordMatch = password === confirmPassword;
        
        // Terms validation
        const termsValid = terms === true;

        const isValid = emailValid && passwordValid && passwordMatch && termsValid;
        
        console.log('[Stepper] Step 4 validation result:', isValid);
        
        if (!isValid) {
          if (!emailValid) console.error('[Stepper] Invalid email format');
          if (!passwordValid) console.error('[Stepper] Password must be at least 6 characters');
          if (!passwordMatch) console.error('[Stepper] Passwords do not match');
          if (!termsValid) console.error('[Stepper] You must accept the terms and conditions');
        }

        return isValid;
      }

      // Show toast notification
      function showToast(message, type = 'info') {
        // Remove existing toasts
        const existingToasts = document.querySelectorAll('.signup-toast');
        existingToasts.forEach(toast => toast.remove());
        
        const toast = document.createElement('div');
        toast.className = 'signup-toast';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 1rem 1.5rem;
          border-radius: 6px;
          color: white;
          font-weight: 500;
          z-index: 10001;
          max-width: 400px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
          ${type === 'error' ? 'background: #ef4444;' : 
            type === 'success' ? 'background: #10b981;' : 
            'background: #3b82f6;'}
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 5000);
      }

      // OLD HANDLE NEXT CLICK DISABLED - Using new step-level validation system
      async function handleNextClick(event) {
        // This function is disabled - new validation system handles everything
        console.log('[Stepper] Old handleNextClick disabled - using new validation system');
        return;
        
        // DISABLED CODE BELOW - DO NOT UNCOMMENT
        if (false) {
        event.preventDefault();
        
        const { element: currentElement, number: stepNumber } = getCurrentStep();
        
        console.log(`[Stepper] Next clicked - current step: ${stepNumber}`);
        
        // Prevent form submission
        if (event.submitter && event.submitter.form) {
          event.submitter.form.noValidate = true;
        }

        // Debug bypass - set window.SIGNUP_DEBUG_BYPASS = true in console to skip validation
        if (window.SIGNUP_DEBUG_BYPASS === true) {
          console.warn('[Stepper] DEBUG BYPASS enabled - skipping validation');
          showStep(stepNumber + 1);
          return;
        }

        // Validate current step
        let validationPassed = true;
        
        if (stepNumber === 1) {
          validationPassed = validateStep1(currentElement);
        } else if (stepNumber === 2) {
          validationPassed = validateStep2(currentElement);
        } else if (stepNumber === 3) {
          validationPassed = validateStep3(currentElement);
        } else if (stepNumber === 4) {
          validationPassed = validateStep4(currentElement);
        }

        if (!validationPassed) {
          console.log('[Stepper] Validation failed - staying on current step');
          return;
        }

        console.log('[Stepper] Validation passed - processing step data');

        // OLD VALIDATION SYSTEM COMPLETELY DISABLED - Using new per-step validation instead
        // This entire block is disabled to prevent email prompts on Step 1
        if (false) {
          try {
            // Import the signup utils
            const { ensureSignedIn, collectStepOneFields, collectStepTwoFields, collectStepThreeFields, collectStepFourFields } = await import('./js/signup-utils.js');
            const { supabase, getAccountAndCompleteness } = await import('./js/supabase-client.js');
            
            // Ensure user is signed in
            const user = await ensureSignedIn();
            if (!user) {
              console.log('[Stepper] User not signed in - showing sign-in modal');
              return; // User will complete sign-in and click Next again
            }

            console.log('[Stepper] User signed in:', user.email);

            // Collect and save step data
            let stepData = {};
            if (stepNumber === 1) {
              stepData = collectStepOneFields();
              // Save to businesses table
              const { error } = await supabase.from('businesses').upsert({
                owner_id: user.id,
                name: stepData.name,
                industry: stepData.category,
                country: stepData.country,
                city: stepData.city,
                short_description: stepData.description,
                whatsapp: stepData.whatsapp
              }, { onConflict: 'owner_id' });
              
              if (error) {
                console.error('[Stepper] Error saving step 1:', error);
                showToast('Error saving business information: ' + error.message, 'error');
                return;
              }
            }
            // Add other steps as needed...

            // Check completeness and determine next step
            const { data: completenessData, error: completenessError } = await getAccountAndCompleteness();
            if (completenessError) {
              console.error('[Stepper] Error checking completeness:', completenessError);
              showToast('Error checking progress: ' + completenessError.message, 'error');
              return;
            }

            const nextStep = completenessData?.next_step;
            console.log('[Stepper] Next step from completeness:', nextStep);

            if (nextStep === 'done' || nextStep === 'dashboard') {
              console.log('[Stepper] Signup complete - redirecting to dashboard');
              window.location.assign('/owner-activities.html');
              return;
            }

          } catch (error) {
            console.error('[Stepper] Error processing step:', error);
            showToast('Error processing step: ' + error.message, 'error');
            return;
          }
        }

        console.log('[Stepper] Moving to next step');
        showStep(stepNumber + 1);
      }

      // Handle back button click
      function handleBackClick(event) {
        event.preventDefault();
        
        const { number: stepNumber } = getCurrentStep();
        const previousStep = Math.max(1, stepNumber - 1);
        
        console.log(`[Stepper] Back clicked - going from step ${stepNumber} to ${previousStep}`);
        showStep(previousStep);
      }

      // Initialize event listeners
      function initializeEventListeners() {
        if (isInitialized) {
          console.warn('[Stepper] Already initialized - skipping');
          return;
        }

        // OLD BUTTON BINDING DISABLED - Using new validation system
        // const nextButtons = $$(CONFIG.nextSelectors);
        // nextButtons.forEach(button => {
        //   if (button) {
        //     button.type = 'button'; // Prevent form submission
        //     button.addEventListener('click', handleNextClick);
        //     console.log('[Stepper] Bound next button:', button.id || button.className);
        //   }
        // });

        // Bind back buttons
        const backButtons = $$(CONFIG.backSelectors);
        backButtons.forEach(button => {
          if (button) {
            button.type = 'button'; // Prevent form submission
            button.addEventListener('click', handleBackClick);
            console.log('[Stepper] Bound back button:', button.id || button.className);
          }
        });

        // Initialize step display
        showStep(1);
        
        isInitialized = true;
        console.log('[Stepper] Initialization complete');
      }

      // Initialize when DOM is ready
      function initialize() {
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeEventListeners);
        } else {
          initializeEventListeners();
        }
      }

      // Start initialization
      initialize();

      // Debug helpers
      window.__signupDebug = {
        getCurrentStep: () => getCurrentStep().number,
        showStep: (n) => showStep(n),
        forceNext: () => handleNextClick(new Event('click')),
        validateStep1: () => validateStep1(getCurrentStep().element),
        validateStep2: () => validateStep2(getCurrentStep().element),
        bypass: () => { window.SIGNUP_DEBUG_BYPASS = true; },
        unbypass: () => { window.SIGNUP_DEBUG_BYPASS = false; }
      };

    })();
  -->

</body>
</html>


