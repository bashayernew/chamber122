<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Final Fix Test - Chamber122</title>
  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>
  <script type="module" src="/public/js/supabase-client.global.js?v=3"></script>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 20px; 
      background: #1a1a1a; 
      color: #fff; 
      line-height: 1.6;
    }
    .test-section { 
      margin: 30px 0; 
      padding: 25px; 
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%); 
      border-radius: 16px; 
      border: 1px solid #2a2a2a; 
    }
    .success { color: #51cf66; font-weight: bold; }
    .error { color: #ff6b6b; font-weight: bold; }
    .info { color: #74c0fc; }
    .test-button { 
      padding: 12px 24px; 
      background: linear-gradient(135deg, #ffd166, #ffed4e); 
      color: #111; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      margin: 8px; 
      font-weight: 600;
      transition: all 0.2s;
    }
    .test-button:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 4px 12px rgba(255, 209, 102, 0.3);
    }
    .grid { display: grid; gap: 20px; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
    .test-card { 
      background: #2a2a2a; 
      padding: 20px; 
      border-radius: 12px; 
      border-left: 4px solid #ffd166;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-success { background: #51cf66; }
    .status-error { background: #ff6b6b; }
    .status-warning { background: #ffd43b; }
    .status-info { background: #74c0fc; }
  </style>
</head>
<body>
  <h1>üîß Final Fix Test - Chamber122</h1>
  <p class="info">Testing all the fixes: Events, Bulletins, and Add Bulletin Button.</p>

  <div class="test-section">
    <h2>üìä Database Connection Test</h2>
    <div class="grid grid-2">
      <div class="test-card">
        <h3>Events Test</h3>
        <button class="test-button" onclick="testEvents()">Test Events</button>
        <div id="events-result"></div>
      </div>
      <div class="test-card">
        <h3>Bulletins Test</h3>
        <button class="test-button" onclick="testBulletins()">Test Bulletins</button>
        <div id="bulletins-result"></div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>üé® UI Components Test</h2>
    <div class="grid grid-2">
      <div class="test-card">
        <h3>Add Bulletin Button</h3>
        <button class="test-button" onclick="testBulletinButton()">Test Bulletin Button</button>
        <div id="bulletin-button-result"></div>
      </div>
      <div class="test-card">
        <h3>Profile Navigation</h3>
        <button class="test-button" onclick="testProfileNav()">Test Visit Profile</button>
        <div id="profile-nav-result"></div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h2>üì± Live Data Preview</h2>
    <div class="test-card">
      <h3>Real Data from Database</h3>
      <button class="test-button" onclick="loadLiveData()">Load Live Data</button>
      <div id="live-data" class="grid grid-2" style="margin-top: 20px;"></div>
    </div>
  </div>

  <div class="test-section">
    <h2>üîó Quick Navigation</h2>
    <div class="test-card">
      <h3>Test Your Pages</h3>
      <a href="index.html" class="test-button">üè† Home Page</a>
      <a href="directory.html" class="test-button">üìÅ Directory</a>
      <a href="bulletin.html" class="test-button">üì¢ Bulletin</a>
      <a href="events.html" class="test-button">üìÖ Events</a>
    </div>
  </div>

  <script type="module">
    import { supabase } from '/public/js/supabase-client.global.js?v=3';

    // Test Events
    window.testEvents = async function() {
      const result = document.getElementById('events-result');
      result.innerHTML = '<span class="status-indicator status-info"></span>Testing events...';
      
      try {
        const { data, error } = await supabase
          .from('events')
          .select('id, title, status, is_published, start_at, created_at')
          .eq('status', 'published')
          .eq('is_published', true)
          .limit(5);

        if (error) {
          result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Events Error: ${error.message}</span>`;
        } else {
          result.innerHTML = `<span class="status-indicator status-success"></span><span class="success">‚úÖ Found ${data.length} published events</span>`;
        }
      } catch (err) {
        result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Exception: ${err.message}</span>`;
      }
    };

    // Test Bulletins
    window.testBulletins = async function() {
      const result = document.getElementById('bulletins-result');
      result.innerHTML = '<span class="status-indicator status-info"></span>Testing bulletins...';
      
      try {
        const { data, error } = await supabase
          .from('bulletins')
          .select('id, title, content, created_at')
          .eq('status', 'published')
          .limit(5);

        if (error) {
          result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Bulletins Error: ${error.message}</span>`;
        } else {
          result.innerHTML = `<span class="status-indicator status-success"></span><span class="success">‚úÖ Found ${data.length} published bulletins</span>`;
        }
      } catch (err) {
        result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Exception: ${err.message}</span>`;
      }
    };

    // Test Bulletin Button
    window.testBulletinButton = function() {
      const result = document.getElementById('bulletin-button-result');
      result.innerHTML = '<span class="status-indicator status-info"></span>Testing bulletin button...';
      
      try {
        // Check if FAB button exists
        const fabButton = document.querySelector('#fabAddBulletin');
        if (fabButton) {
          result.innerHTML = '<span class="status-indicator status-success"></span><span class="success">‚úÖ Bulletin FAB button found and ready</span>';
        } else {
          result.innerHTML = '<span class="status-indicator status-warning"></span><span class="warning">‚ö†Ô∏è Bulletin FAB button not found (may be on bulletin page)</span>';
        }
      } catch (err) {
        result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Error: ${err.message}</span>`;
      }
    };

    // Test Profile Navigation
    window.testProfileNav = function() {
      const result = document.getElementById('profile-nav-result');
      result.innerHTML = '<span class="status-indicator status-info"></span>Testing profile navigation...';
      
      try {
        if (typeof window.openMSMEOverlay === 'function') {
          result.innerHTML = '<span class="status-indicator status-success"></span><span class="success">‚úÖ Visit Profile function is available</span>';
        } else {
          result.innerHTML = '<span class="status-indicator status-error"></span><span class="error">‚ùå Visit Profile function not found</span>';
        }
      } catch (err) {
        result.innerHTML = `<span class="status-indicator status-error"></span><span class="error">‚ùå Error: ${err.message}</span>`;
      }
    };

    // Load Live Data
    window.loadLiveData = async function() {
      const container = document.getElementById('live-data');
      container.innerHTML = '<div class="col-span-full text-center py-8"><span class="status-indicator status-info"></span>Loading live data...</div>';
      
      try {
        // Load events
        const { data: events } = await supabase
          .from('events')
          .select('id, title, start_at, created_at')
          .eq('status', 'published')
          .eq('is_published', true)
          .limit(3);

        // Load bulletins
        const { data: bulletins } = await supabase
          .from('bulletins')
          .select('id, title, created_at')
          .eq('status', 'published')
          .limit(3);

        // Load businesses
        const { data: businesses } = await supabase
          .from('businesses')
          .select('id, name, category, created_at')
          .eq('status', 'approved')
          .limit(3);

        container.innerHTML = `
          <div class="test-card">
            <h4>üìÖ Recent Events (${events?.length || 0})</h4>
            ${events?.map(e => `<p>‚Ä¢ ${e.title || 'Untitled'}</p>`).join('') || '<p class="text-gray-400">No events found</p>'}
          </div>
          <div class="test-card">
            <h4>üì¢ Latest Bulletins (${bulletins?.length || 0})</h4>
            ${bulletins?.map(b => `<p>‚Ä¢ ${b.title || 'Untitled'}</p>`).join('') || '<p class="text-gray-400">No bulletins found</p>'}
          </div>
          <div class="test-card">
            <h4>üè¢ Featured Businesses (${businesses?.length || 0})</h4>
            ${businesses?.map(b => `<p>‚Ä¢ ${b.name || 'Untitled'}</p>`).join('') || '<p class="text-gray-400">No businesses found</p>'}
          </div>
          <div class="test-card">
            <h4>‚úÖ System Status</h4>
            <p>‚Ä¢ Events: ${events?.length > 0 ? 'Working' : 'No data'}</p>
            <p>‚Ä¢ Bulletins: ${bulletins?.length > 0 ? 'Working' : 'No data'}</p>
            <p>‚Ä¢ Businesses: ${businesses?.length > 0 ? 'Working' : 'No data'}</p>
            <p>‚Ä¢ Database: Connected</p>
          </div>
        `;
      } catch (err) {
        container.innerHTML = `<div class="col-span-full text-center py-8"><span class="status-indicator status-error"></span><span class="error">Error loading live data: ${err.message}</span></div>`;
      }
    };

    // Auto-run tests on page load
    document.addEventListener('DOMContentLoaded', () => {
      testEvents();
      testBulletins();
      testBulletinButton();
      testProfileNav();
      loadLiveData();
    });
  </script>
</body>
</html>
