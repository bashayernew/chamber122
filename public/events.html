<!DOCTYPE html>
<html lang="en" class="dark bg-zinc-900 text-zinc-100">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Events - Chamber122</title>
  <link rel="stylesheet" href="/public/css/dialog.css?v=2">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#10b981',
            secondary: '#3b82f6'
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body data-page="events" class="dark bg-zinc-900 text-zinc-100 min-h-screen">
  <!-- Navigation -->
  <nav class="bg-zinc-800 border-b border-zinc-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <a href="/" class="text-xl font-bold text-white">Chamber122</a>
        </div>
        <div class="flex items-center space-x-4">
          <a href="/public/events.html" class="text-zinc-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Events</a>
          <a href="/public/bulletins.html" class="text-zinc-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Bulletins</a>
          <a href="/public/profile.html" class="text-zinc-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Profile</a>
          <a href="/public/dashboard-owner.html" class="bg-primary text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-primary/90">Dashboard</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">Upcoming Events</h1>
      <p class="text-zinc-400">Discover networking opportunities, training sessions, and community events</p>
    </div>

    <!-- Search and Filter -->
    <div class="mb-6 flex flex-col sm:flex-row gap-4">
      <div class="flex-1">
        <input 
          type="text" 
          id="searchInput"
          placeholder="Search events..." 
          class="w-full px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-primary"
        >
      </div>
      <div class="flex gap-2">
        <button id="create-event-btn" class="px-4 py-2 bg-primary border border-primary rounded-lg text-white hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary">
          <i class="fas fa-plus mr-2"></i>Create Event
        </button>
        <button id="dev-storage-test" style="display:none;margin-left:8px" class="btn btn-secondary">Storage Test</button>
        <select id="typeFilter" class="px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
          <option value="">All Types</option>
          <option value="networking">Networking</option>
          <option value="training">Training</option>
          <option value="promotion">Promotion</option>
        </select>
        <button id="viewToggle" class="px-4 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-white hover:bg-zinc-700 focus:outline-none focus:ring-2 focus:ring-primary">
          <i class="fas fa-th-large"></i>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="text-center py-12">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      <p class="mt-2 text-zinc-400">Loading events...</p>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="text-center py-12 hidden">
      <i class="fas fa-calendar-times text-6xl text-zinc-600 mb-4"></i>
      <h3 class="text-xl font-semibold text-zinc-300 mb-2">No events found</h3>
      <p class="text-zinc-500">Check back later for upcoming events or create one in your dashboard.</p>
    </div>

    <!-- Events Grid -->
    <div id="eventsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
      <!-- Events will be dynamically inserted here -->
    </div>

    <!-- Events List -->
    <div id="eventsList" class="space-y-4 hidden">
      <!-- Events will be dynamically inserted here -->
    </div>
  </main>

  <!-- Login Required Modal -->
  <div id="login-modal-slot"></div>
  <script>
    (async () => {
      const r = await fetch('/public/partials/login-required-modal.html')
      document.getElementById('login-modal-slot').innerHTML = await r.text()
    })()
  </script>

  <!-- Event Form Modal -->
  <div id="event-form-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-zinc-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-bold text-white">Create New Event</h2>
        <button id="close-event-form" class="text-zinc-400 hover:text-white">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="event-form" class="space-y-4">
        <!-- Business Selection -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Business *</label>
          <select id="event-business-select" required class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
            <option value="">Select your business...</option>
          </select>
        </div>
        
        <!-- Event Title -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Event Title *</label>
          <input type="text" id="event-title" required class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
        </div>
        
        <!-- Event Description -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Description *</label>
          <textarea id="event-description" rows="3" required class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
        </div>
        
        <!-- Event Type -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Event Type</label>
          <select id="event-type" class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
            <option value="networking">Networking</option>
            <option value="training">Training</option>
            <option value="promotion">Promotion</option>
            <option value="conference">Conference</option>
            <option value="workshop">Workshop</option>
          </select>
        </div>
        
        <!-- Event Date -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-zinc-300">Start Date & Time *</label>
            <input type="datetime-local" id="event-start" required class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          <div>
            <label class="block text-sm font-medium text-zinc-300">End Date & Time</label>
            <input type="datetime-local" id="event-end" class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
        </div>
        
        <!-- Event Location -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Location</label>
          <input type="text" id="event-location" class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
        </div>
        
        <!-- Event Link -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Registration Link (optional)</label>
          <input type="url" id="event-link" class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
        </div>
        
        <!-- Event Cover Image -->
        <div>
          <label class="block text-sm font-medium text-zinc-300">Cover Image (optional)</label>
          <input type="file" id="event-cover" accept="image/*" class="w-full px-3 py-2 bg-zinc-700 border border-zinc-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary">
        </div>
        
        <!-- Form Actions -->
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" id="cancel-event-form" class="px-4 py-2 bg-zinc-600 text-white rounded-lg hover:bg-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-500">
            Cancel
          </button>
          <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary">
            Create Event
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Dev-only Storage Test Button Script -->
  <script>
    // Show only in dev mode (?dev=1)
    if (new URLSearchParams(location.search).get('dev') === '1') {
      const btn = document.getElementById('dev-storage-test');
      if (btn) {
        btn.style.display = 'inline-flex';
        btn.addEventListener('click', async () => {
          try {
            const { supabase } = await import('/js/supabase-client.global.js?v=3');
            const { data: { user } } = await supabase.auth.getUser();
            if (!user?.id) return alert('Not signed in');
            const { data, error } = await supabase.from('businesses').select('id').eq('owner_id', user.id);
            if (error || !data?.length) return alert('No business found for this user');
            await window.__testStorage(data[0].id);
          } catch (e) {
            console.error('[dev button] storage test error', e);
          }
        });
      }
    }
  </script>

  <!-- Single module entry point -->
  <script type="module" src="/public/js/boot.js?v=2"></script>
</body>
</html>