<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Classic Scripts Final - Chamber122</title>
  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
    .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
    .test-button { background: #6f75ff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    .test-button:hover { background: #5a5fcf; }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .info { color: #2196F3; }
    .log { background: #2a2a2a; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
    .nav-actions { display: flex; align-items: center; gap: 10px; }
    .language-switcher { display: flex; align-items: center; gap: 5px; }
    .lang-btn { background: none; border: none; color: #a0a0a0; cursor: pointer; padding: 5px 10px; }
    .lang-btn.active { color: #6f75ff; font-weight: 600; }
    .lang-separator { color: #333; }
    [data-auth-slot] { display: flex; align-items: center; gap: 10px; }
    .btn { padding: 8px 16px; border-radius: 4px; text-decoration: none; display: inline-block; }
    .btn.primary { background: #6f75ff; color: white; }
    .btn:not(.primary) { background: #333; color: #fff; border: 1px solid #555; }
  </style>
</head>
<body>
  <h1>ðŸ§ª Classic Scripts Final Test</h1>
  
  <!-- Test Navigation -->
  <nav style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #333;">
    <div class="nav-actions">
      <div class="language-switcher"></div>
      <div data-auth-slot></div>
    </div>
  </nav>
  
  <!-- Test Content -->
  <div>
    <h2 data-i18n="test.title">Test Page</h2>
    <p data-i18n="test.description">This is a test page to verify classic scripts work correctly.</p>
  </div>
  
  <div class="test-section">
    <h2>1. Script Loading Test</h2>
    <button class="test-button" onclick="testScriptLoading()">Test Script Loading</button>
    <div id="script-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>2. Supabase Client Test</h2>
    <button class="test-button" onclick="testSupabaseClient()">Test Supabase Client</button>
    <div id="supabase-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>3. I18N Test</h2>
    <button class="test-button" onclick="testI18N()">Test I18N System</button>
    <div id="i18n-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>4. Language Switcher Test</h2>
    <button class="test-button" onclick="testLanguageSwitcher()">Test Language Switcher</button>
    <div id="lang-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>5. Auth Header Test</h2>
    <button class="test-button" onclick="testAuthHeader()">Test Auth Header</button>
    <div id="auth-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>6. Event Functions Test</h2>
    <button class="test-button" onclick="testEventFunctions()">Test Event Functions</button>
    <div id="event-results" class="log"></div>
  </div>

  <div class="test-section">
    <h2>7. Activities Functions Test</h2>
    <button class="test-button" onclick="testActivitiesFunctions()">Test Activities Functions</button>
    <div id="activities-results" class="log"></div>
  </div>

  <!-- Include the classic scripts in correct order -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/supabase-client.global.js?v=1"></script>
  <script src="/js/i18n.js?v=1"></script>
  <script src="/js/language-switcher.js?v=1"></script>
  <script src="/js/header-auth-slot.js?v=1"></script>
  <script src="/js/activities-list.js?v=1"></script>
  <script src="/js/event.js?v=1"></script>

  <script>
    function log(elementId, message, type = 'info') {
      const element = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString();
      element.textContent += `[${timestamp}] ${message}\n`;
      element.className = `log ${type}`;
    }
    
    function testScriptLoading() {
      log('script-results', 'Testing script loading...', 'info');
      
      const scripts = [
        { name: 'Supabase CDN', check: () => typeof window.supabase !== 'undefined' },
        { name: 'Supabase Client Global', check: () => typeof window.sb !== 'undefined' },
        { name: 'I18N System', check: () => typeof window.I18N !== 'undefined' },
        { name: 'Language Switcher', check: () => document.querySelector('.language-switcher') !== null },
        { name: 'Header Auth Slot', check: () => typeof window.initHeaderAuth === 'function' },
        { name: 'Activities List', check: () => typeof window.initActivitiesPage === 'function' },
        { name: 'Event Functions', check: () => typeof window.openEventForm === 'function' }
      ];
      
      let allLoaded = true;
      scripts.forEach(script => {
        if (script.check()) {
          log('script-results', `âœ… ${script.name} loaded successfully`, 'success');
        } else {
          log('script-results', `âŒ ${script.name} not loaded`, 'error');
          allLoaded = false;
        }
      });
      
      if (allLoaded) {
        log('script-results', 'ðŸŽ‰ All scripts loaded successfully!', 'success');
      } else {
        log('script-results', 'âš ï¸ Some scripts failed to load', 'error');
      }
    }
    
    function testSupabaseClient() {
      log('supabase-results', 'Testing Supabase client...', 'info');
      
      try {
        if (!window.sb) {
          throw new Error('Supabase client (window.sb) not available');
        }
        
        log('supabase-results', 'âœ… Supabase client is available', 'success');
        log('supabase-results', `Client type: ${typeof window.sb}`, 'info');
        
        // Test a simple query
        window.sb.auth.getSession().then(({ data, error }) => {
          if (error) {
            log('supabase-results', `âš ï¸ Session check error: ${error.message}`, 'info');
          } else {
            log('supabase-results', `âœ… Session check successful. Authenticated: ${!!data.session}`, 'success');
          }
        }).catch(err => {
          log('supabase-results', `âŒ Session check failed: ${err.message}`, 'error');
        });
        
      } catch (error) {
        log('supabase-results', `âŒ Supabase client error: ${error.message}`, 'error');
      }
    }
    
    function testI18N() {
      log('i18n-results', 'Testing I18N system...', 'info');
      
      if (!window.I18N) {
        log('i18n-results', 'âŒ I18N not available', 'error');
        return;
      }
      
      const functions = ['t', 'setLang', 'getLang', 'applyTranslations'];
      functions.forEach(funcName => {
        if (typeof window.I18N[funcName] === 'function') {
          log('i18n-results', `âœ… I18N.${funcName} is available`, 'success');
        } else {
          log('i18n-results', `âŒ I18N.${funcName} is not available`, 'error');
        }
      });
      
      // Test translation
      const testTranslation = window.I18N.t('test.title', 'Test Title');
      log('i18n-results', `Translation test: "${testTranslation}"`, 'info');
      
      // Test language switching
      window.I18N.setLang('ar').then(() => {
        log('i18n-results', 'âœ… Language switched to Arabic', 'success');
        log('i18n-results', `HTML dir: ${document.documentElement.dir}`, 'info');
        log('i18n-results', `HTML lang: ${document.documentElement.lang}`, 'info');
      }).catch(err => {
        log('i18n-results', `âŒ Language switch failed: ${err.message}`, 'error');
      });
    }
    
    function testLanguageSwitcher() {
      log('lang-results', 'Testing language switcher...', 'info');
      
      const switcher = document.querySelector('.language-switcher');
      if (!switcher) {
        log('lang-results', 'âŒ Language switcher not found', 'error');
        return;
      }
      
      log('lang-results', 'âœ… Language switcher found', 'success');
      
      const buttons = switcher.querySelectorAll('.lang-btn');
      log('lang-results', `Found ${buttons.length} language buttons`, 'info');
      
      buttons.forEach(btn => {
        const lang = btn.getAttribute('data-lang');
        const text = btn.textContent;
        log('lang-results', `Button: ${lang} - "${text}"`, 'info');
      });
      
      // Test clicking a button
      const enBtn = switcher.querySelector('[data-lang="en"]');
      if (enBtn) {
        enBtn.click();
        log('lang-results', 'âœ… Clicked English button', 'success');
      }
    }
    
    function testAuthHeader() {
      log('auth-results', 'Testing auth header...', 'info');
      
      const authSlot = document.querySelector('[data-auth-slot]');
      if (!authSlot) {
        log('auth-results', 'âŒ Auth slot not found', 'error');
        return;
      }
      
      log('auth-results', 'âœ… Auth slot found', 'success');
      log('auth-results', `Auth slot content: ${authSlot.innerHTML.substring(0, 100)}...`, 'info');
      
      if (typeof window.initHeaderAuth === 'function') {
        log('auth-results', 'âœ… initHeaderAuth function available', 'success');
      } else {
        log('auth-results', 'âŒ initHeaderAuth function not available', 'error');
      }
      
      if (typeof window.handleLogout === 'function') {
        log('auth-results', 'âœ… handleLogout function available', 'success');
      } else {
        log('auth-results', 'âŒ handleLogout function not available', 'error');
      }
    }
    
    function testEventFunctions() {
      log('event-results', 'Testing event functions...', 'info');
      
      const functions = [
        'openEventForm',
        'closeEventForm', 
        'loadEvents',
        'initEventsPage'
      ];
      
      functions.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
          log('event-results', `âœ… ${funcName} is available`, 'success');
        } else {
          log('event-results', `âŒ ${funcName} is not available`, 'error');
        }
      });
    }
    
    function testActivitiesFunctions() {
      log('activities-results', 'Testing activities functions...', 'info');
      
      const functions = [
        'initActivitiesPage',
        'loadMoreActivities',
        'reloadActivities',
        'fetchEventsFeed',
        'fetchDashboardFeed',
        'fetchOwnerActivities',
        'toggleUserMenu',
        'toggleMobileMenu'
      ];
      
      functions.forEach(funcName => {
        if (typeof window[funcName] === 'function') {
          log('activities-results', `âœ… ${funcName} is available`, 'success');
        } else {
          log('activities-results', `âŒ ${funcName} is not available`, 'error');
        }
      });
    }
    
    // Auto-run basic tests on page load
    document.addEventListener('DOMContentLoaded', () => {
      log('script-results', 'Classic scripts final test page loaded', 'info');
      log('script-results', 'Click the test buttons to run individual tests', 'info');
      
      // Auto-run script loading test
      setTimeout(() => {
        testScriptLoading();
      }, 1000);
    });
  </script>
</body>
</html>
