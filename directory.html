<!DOCTYPE html>
<html lang="en">
<head>
  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>
  <link rel="stylesheet" href="/css/header.css?v=1">
  <script type="module" src="/public/js/supabase-client.global.js?v=3"></script>
  <script type="module" src="/public/js/header-auth-slot.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSME Directory | Chamber122</title>
  <meta name="description" content="Browse and discover local MSMEs in Kuwait. Search by category, location, and find the perfect business for your needs.">
  <meta name="supabase-url" content="https://gidbvemmqffogakcepka.supabase.co">
  <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w">
  <link rel="stylesheet" href="css/style.css?v=16">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo site-logo">
        <img src="images/logo.png" alt="Chamber122 Logo">
      </a>
      <div class="nav-menu">
        <a href="index.html" class="nav-link" data-i18n="nav.home">Home</a>
        <a href="directory.html" class="nav-link active" data-i18n="nav.directory">Directory</a>
        <a href="events.html" class="nav-link" data-i18n="nav.events">Events</a>
        <a href="bulletin.html" class="nav-link" data-i18n="nav.bulletin">Bulletin</a>
        <a href="about.html" class="nav-link" data-i18n="nav.about">About</a>
        <a href="contact.html" class="nav-link" data-i18n="nav.contact">Contact</a>
      </div>
      <div class="nav-actions">
        <!-- Language toggle -->
        <span id="lang-toggle" class="lang-toggle" aria-label="Language">
          <button data-lang="en" class="lang-btn" data-testid="lang-switch-en">EN</button> |
          <button data-lang="ar" class="lang-btn" data-testid="lang-switch-ar">AR</button>
        </span>
        <!-- Auth slot for session-aware header -->
        <span id="auth-slot">
          <a class="btn" href="/auth.html">Login</a>
          <a class="btn primary" href="/auth.html#signup">Sign Up &amp; Get Listed</a>
        </span>

      </div>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
    </div>
    <div class="mobile-menu" id="mobile-menu">
      <a href="index.html" class="mobile-link">Home</a>
      <a href="directory.html" class="mobile-link">Directory</a>
      <a href="events.html" class="mobile-link">Events</a>
      <a href="bulletin.html" class="mobile-link">Bulletin</a>
      <a href="about.html" class="mobile-link">About</a>
      <a href="contact.html" class="mobile-link">Contact</a>
      <div class="mobile-divider"></div>
      <a href="owner.html" class="mobile-link">
        <i class="fas fa-building"></i>
        My Business
      </a>
      <a href="owner-activities.html" class="mobile-link">
        <i class="fas fa-calendar-alt"></i>
        My Activities
      </a>
      <a href="admin.html" class="mobile-link">
        <i class="fas fa-cog"></i>
        Admin Panel
      </a>
      <div class="mobile-divider"></div>
      <a href="auth.html" class="mobile-link">
        <i class="fas fa-sign-in-alt"></i>
        Login
      </a>
      <a href="get-listed.html" class="mobile-link">
        <i class="fas fa-user-plus"></i>
        Sign Up & Get Listed
      </a>
    </div>
  </nav>

  <!-- Directory Header -->
  <section class="directory-header">
    <div class="directory-hero">
      <h1 data-i18n="page.title">MSME Directory</h1>
      <p data-i18n="page.subtitle">Discover and connect with Kuwait's growing community of micro, small, and medium enterprises</p>
    </div>
    
    <!-- Advanced Search/Filter Bar -->
    <div class="filter-container">
      <div class="filter-bar">
        <div class="filter-group">
          <label for="q" data-i18n="search.label">Search</label>
          <input type="text" id="q" class="filter-input" placeholder-i18n data-i18n="search.placeholder" placeholder="Search by name or description...">
        </div>
        <div class="filter-group">
          <label for="cat" data-i18n="filter.category">Category</label>
          <select id="cat" class="filter-input">
            <option value="" data-i18n="filter.allCategories">All Categories</option>
            <option value="Food & Beverage" data-i18n="filter.categories.food">Food & Beverage</option>
            <option value="Fashion & Beauty" data-i18n="filter.categories.fashion">Fashion & Beauty</option>
            <option value="Cleaning Services" data-i18n="filter.categories.cleaning">Cleaning Services</option>
            <option value="Technology" data-i18n="filter.categories.technology">Technology</option>
            <option value="Home Services" data-i18n="filter.categories.home">Home Services</option>
            <option value="Health & Wellness" data-i18n="filter.categories.health">Health & Wellness</option>
            <option value="Education" data-i18n="filter.categories.education">Education</option>
            <option value="Retail" data-i18n="filter.categories.retail">Retail</option>
            <option value="Automotive" data-i18n="filter.categories.automotive">Automotive</option>
            <option value="Other" data-i18n="filter.categories.other">Other</option>
          </select>
        </div>
        <button id="searchBtn" class="filter-btn">
          <i class="fas fa-search"></i> <span data-i18n="search.label">Search</span>
        </button>
      </div>
    </div>
  </section>

  <!-- Featured MSMEs Carousel -->
  <section class="featured-section">
    <div class="section-header">
      <h2 class="section-title" data-i18n="sections.featured">Featured MSMEs</h2>
      <p class="section-subtitle" data-i18n="sections.featuredSubtitle">Highlighted businesses in our community</p>
    </div>
    
    <div class="featured-carousel">
      <div class="featured-card" onclick="openMSMEOverlay('al-kuwaiti-kitchen')">
        <img src="https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400&h=200&fit=crop" alt="Al Kuwaiti Kitchen">
        <h3>Al Kuwaiti Kitchen</h3>
        <div class="category">Food & Beverage</div>
        <div class="tag featured">Featured</div>
        <div class="explore-btn" data-i18n="msme.viewProfile">View Profile</div>
      </div>
      
      <div class="featured-card" onclick="openMSMEOverlay('desert-rose-boutique')">
        <img src="https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=200&fit=crop" alt="Desert Rose Boutique">
        <h3>Desert Rose Boutique</h3>
        <div class="category">Fashion & Beauty</div>
        <div class="tag featured">Featured</div>
        <div class="explore-btn" data-i18n="msme.viewProfile">View Profile</div>
      </div>
      
      <div class="featured-card" onclick="openMSMEOverlay('techflow-kuwait')">
        <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=200&fit=crop" alt="TechFlow Kuwait">
        <h3>TechFlow Kuwait</h3>
        <div class="category">Technology</div>
        <div class="tag featured">Featured</div>
        <div class="explore-btn" data-i18n="msme.viewProfile">View Profile</div>
      </div>
    </div>
  </section>

  <!-- MSME Grid Directory -->
  <section class="directory-grid-section">
    <div id="list" class="directory-grid">
      <!-- MSME cards will be populated by JavaScript -->
    </div>
    
    <div class="load-more-container">
      <button id="loadMore" class="load-more-btn" style="display: none;">
        <i class="fas fa-plus"></i> Load More Businesses
      </button>
    </div>

    <!-- Recent Events Section -->
    <div class="events-section" style="padding: 40px 0; background: #0f0f0f; border-radius: 12px; margin: 40px 0;">
      <div class="section-header" style="text-align: center; margin-bottom: 40px;">
        <h2 class="section-title" style="color: #fff; font-size: 2.5rem; margin-bottom: 10px;">Recent Events</h2>
        <p class="section-subtitle" style="color: #aaa; font-size: 1.1rem;">Latest events from our MSME community</p>
      </div>
      
      <div id="recent-events-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; padding: 0 20px;">
        <!-- Events will be loaded here -->
      </div>
      
      <div style="text-align: center;">
        <a href="events.html" class="btn primary" style="display: inline-block; padding: 12px 24px; background: #ffd166; color: #111; text-decoration: none; border-radius: 8px; font-weight: 600;">
          View All Events
        </a>
      </div>
    </div>
    
    <div class="cta-section">
      <h3 data-i18n="cta.businessMissing">Is Your Business Missing?</h3>
      <p data-i18n="cta.joinCommunity">Join our community and get discovered by customers across Kuwait</p>
      <a href="get-listed.html" class="cta-btn-large">
        <i class="fas fa-plus"></i> <span data-i18n="cta.joinToday">Join Our Community Today</span>
      </a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-brand">
        <img src="images/logo.png" alt="Chamber122" />
      </div>
      <div class="footer-section">
        <h3 data-i18n="footer.aboutTitle">Chamber122</h3>
        <p data-i18n="footer.about">Connecting Kuwait's MSMEs with opportunities for growth and success. Join our community today.</p>
      </div>
      
      <div class="footer-section">
        <h3 data-i18n="footer.quick">Quick Links</h3>
        <div class="quick-links">
          <ul class="quick-links-list">
            <li><a href="index.html" data-i18n="nav.home">Home</a></li>
            <li><a href="directory.html" data-i18n="nav.directory">Directory</a></li>
            <li><a href="events.html" data-i18n="nav.events">Events</a></li>
            <li><a href="bulletin.html" data-i18n="nav.bulletin">Bulletin</a></li>
            <li><a href="get-listed.html" data-i18n="cta.getListed">Get Listed</a></li>
            <li><a href="about.html" data-i18n="nav.about">About</a></li>
            <li><a href="contact.html" data-i18n="nav.contact">Contact</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-section">
        <h3 data-i18n="footer.contactInfo">Connect</h3>
        <p><a href="https://instagram.com/chamber_122_kw"><i class="fab fa-instagram"></i> Instagram</a></p>
        <p><a href="https://www.tiktok.com/@chamber122"><i class="fab fa-tiktok"></i> TikTok</a></p>
        <p><a href="https://wa.me/96522396999"><i class="fab fa-whatsapp"></i> Phone</a></p>
        <p><a href="mailto:info@chamber122.com"><i class="fas fa-envelope"></i> info@chamber122.com</a></p>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Chamber122. All Rights Reserved. | <span data-i18n="footer.empowering">Empowering Kuwait's MSMEs</span></p>
    </div>
  </footer>

  <!-- Modal Overlay for MSME Details -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div class="modal-header">
        <img id="modal-image" src="" alt="">
        <h2 id="modal-title" class="modal-title"></h2>
        <div id="modal-category" class="modal-category"></div>
      </div>
      <div class="modal-body">
        <p id="modal-description" class="modal-description"></p>
        <div class="modal-story">
          <h4>Why We Started</h4>
          <p id="modal-story"></p>
        </div>
        <div class="modal-actions">
          <a href="#" class="modal-btn primary" id="modal-whatsapp">
            <i class="fab fa-whatsapp"></i> WhatsApp
          </a>
          <a href="#" class="modal-btn secondary" id="modal-email">
            <i class="fas fa-envelope"></i> Email
          </a>
          <a href="#" class="modal-btn secondary" id="modal-website">
            <i class="fas fa-globe"></i> Website
          </a>
          <a href="#" class="modal-btn secondary" id="modal-instagram">
            <i class="fab fa-instagram"></i> Instagram
          </a>
        </div>
      </div>
    </div>
  </div>

  <script src="js/main.js?v=7"></script>
  <script type="module" src="js/directory.js"></script>
  
  <!-- Load Recent Events -->
  <script type="module">
    import { supabase } from '/public/js/supabase-client.global.js?v=3';
    
    async function loadRecentEvents() {
      try {
        const { data: events, error } = await supabase
          .from('activities_base')
          .select('id,business_id,title,description,location,start_at,end_at,cover_image_url,status,is_published,deleted_at,created_at')
          .eq('type', 'event')
          .eq('is_published', true)
          .is('deleted_at', null)
          .order('start_at', { ascending: false })
          .limit(6);

        if (error) {
          console.error('Error loading recent events:', error);
          return;
        }

        const eventsGrid = document.getElementById('recent-events-grid');
        if (!eventsGrid) return;

        if (!events || events.length === 0) {
          eventsGrid.innerHTML = '<p style="color: #aaa; text-align: center; grid-column: 1 / -1;">No recent events found.</p>';
          return;
        }

        eventsGrid.innerHTML = events.map(event => `
          <div class="event-card" style="background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; overflow: hidden; transition: transform 0.2s;">
            <div style="height: 150px; background: linear-gradient(135deg, #ffd166, #ff6b6b); position: relative;">
              ${event.cover_image_url ? 
                `<img src="${event.cover_image_url}" alt="${event.title}" style="width: 100%; height: 100%; object-fit: cover;">` :
                `<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #111; font-size: 32px;"><i class="fas fa-calendar-alt"></i></div>`
              }
              <div style="position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                ${event.type || 'Event'}
              </div>
            </div>
            <div style="padding: 16px;">
              <h3 style="margin: 0 0 8px; color: #fff; font-size: 16px; font-weight: 600; line-height: 1.3;">${event.title || 'Untitled Event'}</h3>
              <div style="margin-bottom: 8px; color: #ffd166; font-size: 14px;">
                <i class="fas fa-clock" style="margin-right: 4px;"></i>
                ${event.start_at ? new Date(event.start_at).toLocaleDateString() : 'TBA'}
              </div>
              ${event.location ? `
                <div style="margin-bottom: 8px; color: #aaa; font-size: 14px;">
                  <i class="fas fa-map-marker-alt" style="margin-right: 4px;"></i>
                  ${event.location}
                </div>
              ` : ''}
              <a href="/event.html?id=${event.id}" style="display: block; margin-top: 12px; text-align: center; background: #ffd166; color: #111; padding: 8px 12px; border-radius: 6px; text-decoration: none; font-size: 14px; font-weight: 600;">
                Learn More
              </a>
            </div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading recent events:', error);
      }
    }

    // Load events when page loads
    document.addEventListener('DOMContentLoaded', loadRecentEvents);
  </script>
  <script type="module" src="js/msme-overlay.js"></script>
  <script type="module" src="js/analytics.js"></script>
  <script type="module" src="js/language-switcher.js"></script>
  <script type="module" src="./js/i18n.js"></script>
  <!-- Import authentication and gating scripts -->
  <script type="module" src="js/modal-login-required.js"></script>
  <script type="module" src="js/guest.js"></script>
  <link rel="stylesheet" href="css/modal.css">
  <link rel="stylesheet" href="css/header.css?v=1">
</body>
</html>