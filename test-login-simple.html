<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Login Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #0b0c12; color: #e9e9f1; }
    .card { background: #101321; border: 1px solid #222640; border-radius: 16px; padding: 20px; margin: 20px 0; max-width: 400px; }
    input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #262b45; background: #0c1022; color: #f2f3ff; }
    button { background: #6f75ff; border: 0; font-weight: 700; cursor: pointer; }
    .error { color: #ff6b6b; }
    .success { color: #51cf66; }
    pre { background: #1a1a1a; padding: 10px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Simple Login Test</h1>
  
  <div class="card">
    <h3>Test Login</h3>
    <input type="email" id="email" placeholder="your@email.com" value="test@example.com">
    <input type="password" id="password" placeholder="password" value="testpassword">
    <button onclick="testLogin()">Test Login</button>
    <div id="result"></div>
  </div>

  <div class="card">
    <h3>Check Session</h3>
    <button onclick="checkSession()">Check Current Session</button>
    <div id="session-result"></div>
  </div>

  <div class="card">
    <h3>Console Logs</h3>
    <pre id="logs"></pre>
  </div>

  <script>
    window.SUPABASE_URL = "https://gidbvemmqffogakcepka.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpZGJ2ZW1tcWZmb2dha2NlcGthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NjI0MTUsImV4cCI6MjA3MjMzODQxNX0.rFFi4gq5ZUApmJM_FM5nfGpcPCHy9FLedVwmJOEzV1w";
  </script>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2.57.4';
    
    const supabase = createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY, {
      auth: {
        autoRefreshToken: true,
        persistSession: true,
        detectSessionInUrl: true
      }
    });

    function log(message, type = 'info') {
      const logs = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#e9e9f1';
      logs.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
      console.log(`[${timestamp}] ${message}`);
    }

    window.testLogin = async function() {
      const result = document.getElementById('result');
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      log(`Testing login with email: ${email}`);
      
      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email: email,
          password: password
        });
        
        if (error) {
          log(`Login error: ${error.message}`, 'error');
          result.innerHTML = `<div class="error">❌ Login failed: ${error.message}</div>`;
        } else {
          log(`Login successful! User: ${data.user?.email}`, 'success');
          result.innerHTML = `<div class="success">✅ Login successful! User: ${data.user?.email}</div>`;
          
          // Check if session is stored
          setTimeout(() => checkSession(), 1000);
        }
      } catch (err) {
        log(`Login exception: ${err.message}`, 'error');
        result.innerHTML = `<div class="error">❌ Exception: ${err.message}</div>`;
      }
    };

    window.checkSession = async function() {
      const result = document.getElementById('session-result');
      log('Checking current session...');
      
      try {
        const { data, error } = await supabase.auth.getSession();
        
        if (error) {
          log(`Session error: ${error.message}`, 'error');
          result.innerHTML = `<div class="error">❌ Session error: ${error.message}</div>`;
        } else if (data.session?.user) {
          log(`Session found! User: ${data.session.user.email}`, 'success');
          result.innerHTML = `<div class="success">✅ Session active! User: ${data.session.user.email}</div>`;
        } else {
          log('No active session found', 'error');
          result.innerHTML = `<div class="error">❌ No active session</div>`;
        }
      } catch (err) {
        log(`Session check exception: ${err.message}`, 'error');
        result.innerHTML = `<div class="error">❌ Exception: ${err.message}</div>`;
      }
    };

    // Initial session check
    log('Page loaded');
    checkSession();
  </script>
</body>
</html>
